<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento de Relat√≥rios de Auditoria - Brasil 21</title>
    <link rel="icon" type="image/png" href="https://complexobrasil21.com.br/wp-content/uploads/2023/04/cropped-favicon-32x32.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        :root {--dourado:#C9A227;--dourado-hover:#B8922A;--azul-marinho:#1A2E4C;--azul-claro:#2A4A6C;--branco:#FFFFFF;--cinza-claro:#F5F5F5;--cinza-medio:#E0E0E0;--cinza-escuro:#333333;--vermelho:#DC3545;--laranja:#FFA500;--verde:#28A745;--verde-claro:#D4EDDA;--amarelo-claro:#FFF3CD;--vermelho-claro:#F8D7DA;}
        *{margin:0;padding:0;box-sizing:border-box;}
        body{font-family:'Inter',sans-serif;background:var(--cinza-claro);color:var(--cinza-escuro);min-height:100vh;}
        header{background:linear-gradient(135deg,var(--azul-marinho),var(--azul-claro));color:var(--branco);padding:15px 30px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,0.2);position:sticky;top:0;z-index:1000;flex-wrap:wrap;gap:15px;}
        .logo-container{display:flex;align-items:center;gap:15px;}
        .logo-container img{height:50px;filter:brightness(0) invert(1);}
        .logo-text h1{font-size:1.3rem;font-weight:600;color:var(--dourado);}
        .logo-text span{font-size:0.8rem;opacity:0.9;}
        nav{display:flex;gap:8px;flex-wrap:wrap;}
        nav button{background:transparent;border:2px solid var(--dourado);color:var(--dourado);padding:8px 16px;border-radius:25px;cursor:pointer;font-weight:500;transition:all 0.3s;font-size:0.85rem;}
        nav button:hover,nav button.active{background:var(--dourado);color:var(--azul-marinho);}
        nav button i{margin-right:6px;}
        .user-info{display:flex;align-items:center;gap:15px;}
        .user-info span{font-size:0.85rem;}
        .btn-logout{background:var(--vermelho);border:none;color:white;padding:8px 15px;border-radius:20px;cursor:pointer;font-size:0.8rem;}
        .container{max-width:1400px;margin:0 auto;padding:20px;}
        .page{display:none;}
        .page.active{display:block;}
        .login-container{display:flex;justify-content:center;align-items:center;min-height:calc(100vh - 100px);}
        .login-box{background:var(--azul-marinho);padding:40px;border-radius:15px;box-shadow:0 5px 30px rgba(0,0,0,0.3);width:100%;max-width:400px;text-align:center;}
        .login-box img{height:80px;margin-bottom:20px;filter:brightness(0) invert(1);}
        .login-box h2{color:var(--dourado);margin-bottom:30px;}
        .form-group{margin-bottom:20px;text-align:left;}
        .form-group label{display:block;margin-bottom:5px;font-weight:500;color:var(--branco);}
        .form-group input{width:100%;padding:12px 15px;border:2px solid var(--cinza-medio);border-radius:8px;font-size:1rem;background:var(--branco);color:var(--cinza-escuro);}
        .form-group input:focus,.form-group textarea:focus,.form-group select:focus{outline:none;border-color:var(--dourado);}
        .form-group textarea,.form-group select{width:100%;padding:12px 15px;border:2px solid var(--cinza-medio);border-radius:8px;font-size:1rem;font-family:inherit;}
        .btn-primary{background:var(--dourado);color:var(--azul-marinho);border:none;padding:15px 30px;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;width:100%;}
        .btn-primary:hover{background:var(--dourado-hover);}
        .login-links{margin-top:20px;color:var(--branco);}
        .login-links a{color:var(--dourado);text-decoration:none;font-size:0.9rem;}
        .stats-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px;}
        .stat-card{background:var(--branco);padding:25px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.05);text-align:center;transition:transform 0.3s;cursor:pointer;}
        .stat-card:hover{transform:translateY(-5px);}
        .stat-card.total{border-left:5px solid var(--azul-marinho);}
        .stat-card.alta{border-left:5px solid var(--vermelho);}
        .stat-card.media{border-left:5px solid var(--laranja);}
        .stat-card.baixa{border-left:5px solid var(--verde);}
        .stat-card .icon{font-size:2.5rem;margin-bottom:10px;}
        .stat-card.total .icon{color:var(--azul-marinho);}
        .stat-card.alta .icon{color:var(--vermelho);}
        .stat-card.media .icon{color:var(--laranja);}
        .stat-card.baixa .icon{color:var(--verde);}
        .stat-card .numero{font-size:2.5rem;font-weight:700;color:var(--azul-marinho);}
        .stat-card .numero-filtrado{font-size:1rem;color:var(--dourado);font-weight:600;}
        .stat-card .label{font-size:0.9rem;color:#666;margin-top:5px;}
        .filters-section{background:var(--branco);padding:20px;border-radius:12px;margin-bottom:20px;}
        .filters-section h3{color:var(--azul-marinho);margin-bottom:15px;display:flex;align-items:center;gap:10px;}
        .filters-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;align-items:end;}
        .filter-group label{display:block;font-size:0.85rem;font-weight:500;color:var(--azul-marinho);margin-bottom:5px;}
        .filter-group select,.filter-group input{width:100%;padding:10px;border:2px solid var(--cinza-medio);border-radius:8px;}
        .filter-buttons{display:flex;gap:10px;}
        .btn-filter{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:500;}
        .btn-filter.primary{background:var(--dourado);color:var(--azul-marinho);}
        .btn-filter.secondary{background:var(--cinza-medio);color:var(--cinza-escuro);}
        .table-container{background:var(--branco);border-radius:12px;overflow:hidden;}
        .table-header{background:var(--azul-marinho);color:var(--branco);padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
        .results-count{background:var(--dourado);color:var(--azul-marinho);padding:5px 15px;border-radius:20px;font-weight:600;}
        table{width:100%;border-collapse:collapse;}
        thead{background:var(--cinza-claro);}
        th{padding:12px 10px;text-align:left;font-weight:600;color:var(--azul-marinho);border-bottom:2px solid var(--cinza-medio);font-size:0.85rem;}
        td{padding:10px;border-bottom:1px solid var(--cinza-medio);font-size:0.85rem;}
        tr:hover{background:#f8f9fa;}
        .badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:0.7rem;font-weight:600;}
        .badge-alta{background:var(--vermelho-claro);color:var(--vermelho);}
        .badge-media{background:var(--amarelo-claro);color:#856404;}
        .badge-baixa{background:var(--verde-claro);color:var(--verde);}
        .badge-pendente{background:var(--vermelho-claro);color:var(--vermelho);}
        .badge-emandamento{background:var(--amarelo-claro);color:#856404;}
        .badge-concluido{background:var(--verde-claro);color:var(--verde);}
        .btn-detalhes{background:var(--azul-marinho);color:var(--branco);border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:0.75rem;}
        .btn-pdf{background:var(--vermelho);color:var(--branco);border:none;padding:5px 8px;border-radius:5px;cursor:pointer;font-size:0.75rem;margin-left:3px;}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:2000;justify-content:center;align-items:center;}
        .modal.active{display:flex;}
        .modal-content{background:var(--branco);border-radius:15px;width:90%;max-width:800px;max-height:90vh;overflow-y:auto;}
        .modal-header{background:var(--azul-marinho);color:var(--branco);padding:20px;display:flex;justify-content:space-between;align-items:center;border-radius:15px 15px 0 0;}
        .btn-close{background:none;border:none;color:var(--branco);font-size:1.5rem;cursor:pointer;}
        .modal-body{padding:25px;}
        .detail-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;}
        .detail-item{background:var(--cinza-claro);padding:15px;border-radius:10px;}
        .detail-item label{display:block;font-size:0.75rem;font-weight:600;color:var(--dourado);text-transform:uppercase;margin-bottom:5px;}
        .detail-item.full-width{grid-column:1/-1;}
        .relatorios-links{margin-top:20px;padding-top:20px;border-top:2px solid var(--cinza-medio);}
        .relatorios-links h4{color:var(--azul-marinho);margin-bottom:15px;}
        .relatorio-link{display:inline-flex;align-items:center;gap:8px;background:var(--vermelho);color:var(--branco);padding:10px 15px;border-radius:8px;text-decoration:none;margin:5px;font-size:0.85rem;cursor:pointer;}
        .relatorios-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;}
        .relatorio-card{background:var(--branco);border-radius:12px;overflow:hidden;transition:transform 0.3s;}
        .relatorio-card:hover{transform:translateY(-5px);}
        .relatorio-card-header{background:var(--azul-marinho);color:var(--branco);padding:15px;}
        .relatorio-card-header h4{font-size:1rem;margin-bottom:5px;}
        .relatorio-card-header .categoria{display:inline-block;background:var(--dourado);color:var(--azul-marinho);padding:2px 8px;border-radius:15px;font-size:0.7rem;font-weight:600;}
        .relatorio-card-body{padding:15px;}
        .relatorio-info{display:flex;justify-content:space-between;margin-bottom:10px;font-size:0.85rem;color:#666;}
        .relatorio-pontos{margin-bottom:15px;}
        .relatorio-pontos h5{color:var(--azul-marinho);margin-bottom:8px;font-size:0.85rem;}
        .pontos-badges{display:flex;flex-wrap:wrap;gap:5px;}
        .ponto-badge{background:var(--cinza-claro);color:var(--azul-marinho);padding:3px 8px;border-radius:15px;font-size:0.7rem;font-weight:500;cursor:pointer;}
        .ponto-badge:hover{background:var(--dourado);}
        .btn-abrir-pdf{display:flex;align-items:center;justify-content:center;gap:8px;background:var(--vermelho);color:var(--branco);border:none;padding:10px 15px;border-radius:8px;cursor:pointer;font-weight:600;width:100%;font-size:0.85rem;}
        .pdf-viewer{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:var(--cinza-claro);z-index:3000;}
        .pdf-viewer.active{display:block;}
        .pdf-viewer-header{background:var(--azul-marinho);color:var(--branco);padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
        .btn-voltar{background:var(--dourado);color:var(--azul-marinho);border:none;padding:10px 20px;border-radius:25px;cursor:pointer;font-weight:600;}
        .pdf-viewer-content{height:calc(100vh - 60px);display:flex;}
        .pdf-embed{flex:1;border:none;}
        .pdf-sidebar{width:280px;background:var(--branco);padding:15px;overflow-y:auto;border-left:2px solid var(--cinza-medio);}
        .pdf-sidebar h4{color:var(--azul-marinho);margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid var(--dourado);font-size:0.9rem;}
        .pdf-ponto-link{display:block;padding:10px;background:var(--cinza-claro);border-radius:8px;margin-bottom:8px;cursor:pointer;}
        .pdf-ponto-link:hover{background:var(--dourado);}
        .pdf-ponto-link.ponto-destacado{background:var(--dourado);border:2px solid var(--azul-marinho);}
        .pdf-ponto-link strong{display:block;color:var(--azul-marinho);margin-bottom:3px;font-size:0.85rem;}
        .pdf-ponto-link small{font-size:0.75rem;opacity:0.8;}
        .admin-section{background:var(--branco);padding:20px;border-radius:12px;margin-bottom:20px;}
        .admin-section h3{color:var(--azul-marinho);margin-bottom:15px;display:flex;align-items:center;gap:10px;font-size:1.1rem;}
        .admin-buttons{display:flex;flex-wrap:wrap;gap:10px;}
        .btn-admin{padding:12px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:8px;font-size:0.85rem;}
        .btn-admin.primary{background:var(--dourado);color:var(--azul-marinho);}
        .btn-admin.danger{background:var(--vermelho);color:var(--branco);}
        .btn-admin.success{background:var(--verde);color:var(--branco);}
        .usuario-card{background:var(--cinza-claro);padding:15px;border-radius:10px;margin-bottom:10px;}
        .usuario-card-header{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:10px;}
        .usuario-info strong{color:var(--azul-marinho);display:block;margin-bottom:3px;}
        .usuario-info small{color:#666;font-size:0.8rem;}
        .usuario-datas{font-size:0.75rem;color:#666;margin-top:10px;padding-top:10px;border-top:1px solid var(--cinza-medio);}
        .usuario-datas div{margin-bottom:3px;}
        .usuario-datas i{margin-right:5px;color:var(--dourado);width:16px;}
        .btn-aprovar{background:var(--verde);color:white;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;font-size:0.8rem;}
        .btn-revogar{background:var(--vermelho);color:white;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;font-size:0.8rem;}
        .dashboard-filter{background:var(--branco);padding:15px 20px;border-radius:12px;margin-bottom:20px;display:flex;align-items:center;gap:15px;flex-wrap:wrap;}
        .dashboard-filter label{font-weight:600;color:var(--azul-marinho);}
        .dashboard-filter select{padding:10px 20px;border:2px solid var(--dourado);border-radius:25px;font-size:0.9rem;cursor:pointer;min-width:180px;}
        .charts-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:20px;margin-bottom:20px;}
        .chart-card{background:var(--branco);border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.05);}
        .chart-card h4{color:var(--azul-marinho);margin-bottom:20px;text-align:center;font-size:1rem;}
        .chart-wrapper{max-width:300px;margin:0 auto;}
        .chart-wrapper-bar{height:500px;}
        .alert{padding:15px;border-radius:8px;margin-bottom:15px;}
        .alert-success{background:var(--verde-claro);color:var(--verde);}
        .alert-error{background:var(--vermelho-claro);color:var(--vermelho);}
        .requires-auth{display:none;}
        body.logged-in .requires-auth{display:flex;}
        body.logged-in .login-only{display:none;}
        @media(max-width:768px){header{padding:10px 15px;}nav button{padding:6px 12px;font-size:0.8rem;}.charts-grid{grid-template-columns:1fr;}.pdf-viewer-content{flex-direction:column;}.pdf-sidebar{width:100%;height:200px;}}
        .pdf-viewer-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:3000;}
        .pdf-viewer-modal.active{display:flex;}
        .pdf-viewer-container{display:flex;width:100%;height:100%;}
        .pdf-sidebar-new{width:320px;background:white;overflow-y:auto;display:flex;flex-direction:column;}
        .pdf-sidebar-header{background:var(--azul-marinho);color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
        .pdf-sidebar-header h3{font-size:1rem;color:var(--dourado);}
        .pdf-sidebar-close{background:var(--vermelho);border:none;color:white;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:1.2rem;}
        .pdf-pontos-list{flex:1;overflow-y:auto;padding:10px;}
        .pdf-ponto-item{background:#f8f9fa;border:2px solid #e9ecef;border-radius:8px;padding:12px;margin-bottom:8px;cursor:pointer;transition:all 0.2s;}
        .pdf-ponto-item:hover{background:#e9ecef;border-color:var(--dourado);}
        .pdf-ponto-item.active{background:var(--dourado);border-color:var(--azul-marinho);}
        .pdf-ponto-item .ponto-id{font-weight:bold;color:var(--azul-marinho);font-size:0.95rem;}
        .pdf-ponto-item.active .ponto-id{color:var(--azul-marinho);}
        .pdf-ponto-item .ponto-desc{font-size:0.8rem;color:#666;margin-top:4px;}
        .pdf-ponto-item.active .ponto-desc{color:#333;}
        .pdf-ponto-item .ponto-page{font-size:0.75rem;color:var(--dourado);margin-top:4px;font-weight:600;}
        .pdf-main{flex:1;background:#525659;overflow:auto;padding:20px;display:flex;flex-direction:column;align-items:center;}
        .pdf-controls{background:white;padding:12px 20px;border-radius:8px;margin-bottom:15px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;box-shadow:0 2px 10px rgba(0,0,0,0.2);position:sticky;top:0;z-index:100;}
        .pdf-controls button{background:var(--azul-marinho);color:white;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;font-size:0.9rem;transition:all 0.2s;}
        .pdf-controls button:hover{background:var(--azul-claro);}
        .pdf-controls span{font-size:0.9rem;}
        .pdf-status{color:white;background:var(--dourado);padding:8px 15px;border-radius:5px;font-size:0.85rem;font-weight:600;}
        .page-wrapper{position:relative;margin-bottom:15px;box-shadow:0 4px 20px rgba(0,0,0,0.4);}
        .pdf-page{display:block;background:white;}
        .highlight-box{position:absolute;background:rgba(201,162,39,0.35);border:3px solid var(--dourado);pointer-events:none;border-radius:4px;animation:pulse 1.5s ease-in-out infinite;}
        .highlight-box.editable{pointer-events:auto;cursor:move;resize:both;overflow:hidden;border:3px dashed var(--vermelho);animation:none;}
        .highlight-box.editable:active{cursor:grabbing;}
        @keyframes pulse{0%,100%{box-shadow:0 0 8px var(--dourado);}50%{box-shadow:0 0 25px var(--dourado),0 0 40px var(--dourado);}}
        .page-label{text-align:center;color:#fff;padding:8px;font-size:0.9rem;background:rgba(0,0,0,0.4);margin-top:-5px;border-radius:0 0 5px 5px;}
        .timeline-col{min-width:180px;border-right:1px solid #e0e0e0;padding:10px;background:#fafafa;}
        .timeline-col:last-child{border-right:none;}
        .timeline-header{background:var(--azul-marinho);color:#fff;padding:10px;border-radius:8px 8px 0 0;text-align:center;font-size:0.85rem;}
        .timeline-header .data{font-weight:bold;font-size:1rem;}
        .timeline-header .titulo{font-size:0.75rem;margin-top:3px;opacity:0.9;}
        .timeline-body{padding:10px 5px;min-height:100px;}
        .timeline-item{background:#fff;padding:8px;border-radius:6px;margin-bottom:8px;font-size:0.75rem;border-left:3px solid var(--dourado);box-shadow:0 1px 3px rgba(0,0,0,0.1);}
        .timeline-item.doc{border-left-color:var(--azul-claro);}
        .timeline-item.pa{border-left-color:var(--verde);}
        .timeline-item.manual{border-left-color:var(--dourado);}
        .timeline-item-title{font-weight:bold;color:var(--azul-marinho);margin-bottom:3px;}
        .timeline-item-meta{color:#888;font-size:0.7rem;}
        .timeline-tipo{display:inline-block;padding:2px 6px;border-radius:10px;font-size:0.65rem;margin-left:5px;}
        .timeline-tipo.visita{background:#e8f5e9;color:#2e7d32;}
        .timeline-tipo.entrega{background:#e3f2fd;color:#1565c0;}
        .timeline-tipo.email{background:#fff3e0;color:#ef6c00;}
        .timeline-tipo.reuniao{background:#f3e5f5;color:#7b1fa2;}
        .timeline-tipo.prazo{background:#ffebee;color:#c62828;}
        .timeline-tipo.outro{background:#eceff1;color:#546e7a;}
        .gantt-wrapper{min-width:max-content;}
        .gantt-header{display:flex;border-bottom:2px solid var(--azul-marinho);}
        .gantt-header-task{min-width:200px;max-width:200px;padding:10px;font-weight:bold;background:var(--azul-marinho);color:#fff;position:sticky;left:0;z-index:2;}
        .gantt-header-months{display:flex;flex:1;}
        .gantt-month{text-align:center;font-weight:bold;color:#fff;padding:8px 0;font-size:0.85rem;}
        .gantt-month.out{background:#1565c0;}
        .gantt-month.nov{background:#2e7d32;}
        .gantt-month.dez{background:#c62828;}
        .gantt-month.jan{background:#7b1fa2;}
        .gantt-days{display:flex;background:#f5f5f5;border-bottom:1px solid #ddd;}
        .gantt-days-label{min-width:200px;max-width:200px;padding:5px 10px;font-size:0.7rem;color:#666;background:#e8e8e8;position:sticky;left:0;z-index:2;}
        .gantt-day{min-width:28px;max-width:28px;text-align:center;padding:4px 0;font-size:0.65rem;color:#666;border-right:1px solid #eee;}
        .gantt-day.weekend{background:#f0f0f0;color:#999;}
        .gantt-day.today{background:var(--dourado);color:#fff;font-weight:bold;}
        .gantt-row{display:flex;border-bottom:1px solid #eee;}
        .gantt-row:hover{background:#f8f9fa;}
        .gantt-task{min-width:200px;max-width:200px;padding:12px 10px;font-size:0.8rem;background:#fff;border-right:1px solid #ddd;position:sticky;left:0;z-index:1;}
        .gantt-task-title{font-weight:bold;color:var(--azul-marinho);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .gantt-task-dates{font-size:0.7rem;color:#888;margin-top:2px;}
        .gantt-cells{display:flex;flex:1;position:relative;min-height:45px;}
        .gantt-cell{min-width:28px;max-width:28px;border-right:1px solid #f0f0f0;}
        .gantt-cell.weekend{background:#fafafa;}
        .gantt-bar{position:absolute;height:24px;top:50%;transform:translateY(-50%);border-radius:4px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:0.65rem;font-weight:bold;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,0.2);transition:transform 0.2s;}
        .gantt-bar:hover{transform:translateY(-50%) scale(1.02);box-shadow:0 3px 8px rgba(0,0,0,0.3);}
        .gantt-bar.visita{background:linear-gradient(135deg,#2e7d32,#4caf50);}
        .gantt-bar.entrega{background:linear-gradient(135deg,#1565c0,#42a5f5);}
        .gantt-bar.email{background:linear-gradient(135deg,#ef6c00,#ffa726);}
        .gantt-bar.reuniao{background:linear-gradient(135deg,#7b1fa2,#ab47bc);}
        .gantt-bar.prazo{background:linear-gradient(135deg,#c62828,#ef5350);}
        .gantt-bar.outro{background:linear-gradient(135deg,#546e7a,#78909c);}
        .gantt-tooltip{position:absolute;background:var(--azul-marinho);color:#fff;padding:10px 15px;border-radius:8px;font-size:0.8rem;z-index:100;box-shadow:0 4px 15px rgba(0,0,0,0.3);pointer-events:none;max-width:250px;}
        .gantt-tooltip::after{content:'';position:absolute;top:100%;left:20px;border:8px solid transparent;border-top-color:var(--azul-marinho);}
        .install-btn{background:transparent;border:1px solid var(--dourado);color:var(--dourado);padding:5px 10px;border-radius:5px;cursor:pointer;font-size:0.75rem;display:none;align-items:center;gap:5px;transition:all 0.3s;}
        .install-btn:hover{background:var(--dourado);color:var(--azul-marinho);}
    </style>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Auditoria">
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="https://complexobrasil21.com.br/wp-content/uploads/2023/04/Logos_Brasil_21-1-scaled.png" alt="Brasil 21" onerror="this.style.display='none'">
            <div class="logo-text"><h1>Acompanhamento de Relat√≥rios de Auditoria</h1><span>Revis√£o de Processos - Hot√©is Bras√≠lia</span></div>
        </div>
        <nav class="requires-auth">
            <button id="btnAcompanhamento" class="active" onclick="showPage('acompanhamento')"><i class="fas fa-chart-pie"></i> Dashboard</button>
            <button id="btnDashboard" onclick="showPage('dashboard')"><i class="fas fa-th-large"></i> Vis√£o Completa</button>
            <button id="btnRelatorios" onclick="showPage('relatorios')"><i class="fas fa-file-pdf"></i> Relat√≥rios</button>
            <button id="btnAdmin" onclick="showPage('admin')"><i class="fas fa-cog"></i> Admin</button>
            <button id="btnInstallApp" class="install-btn" onclick="installApp()" title="Instalar atalho na √°rea de trabalho"><i class="fas fa-download"></i> Instalar</button>
        </nav>
        <div class="user-info requires-auth">
            <span id="userEmail"></span>
            <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
        </div>
    </header>
    <div class="container">
        <div id="pageLogin" class="page login-only active">
            <div class="login-container">
                <div class="login-box">
                    <img src="https://complexobrasil21.com.br/wp-content/uploads/2023/04/Logos_Brasil_21-1-scaled.png" alt="Brasil 21" onerror="this.style.display='none'">
                    <h2>Relat√≥rio de Auditoria</h2>
                    <div id="loginAlert"></div>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group"><label>E-mail</label><input type="email" id="loginEmail" required placeholder="seu@email.com"></div>
                        <div class="form-group"><label>Senha</label><div style="position:relative;"><input type="password" id="loginPassword" required style="padding-right:45px;"><button type="button" onclick="togglePassword('loginPassword')" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#666;"><i class="fas fa-eye"></i></button></div></div>
                        <button type="submit" class="btn-primary"><i class="fas fa-sign-in-alt"></i> Entrar</button>
                    </form>
                    <div class="login-links"><a href="#" onclick="showCadastro()">Criar conta</a> | <a href="#" onclick="resetPassword()">Esqueci senha</a></div>
                </div>
            </div>
        </div>
        <div id="pageCadastro" class="page">
            <div class="login-container">
                <div class="login-box">
                    <h2>Criar Conta</h2>
                    <div id="cadastroAlert"></div>
                    <form onsubmit="handleCadastro(event)">
                        <div class="form-group"><label>Nome completo</label><input type="text" id="cadastroNome" required></div>
                        <div class="form-group"><label>E-mail</label><input type="email" id="cadastroEmail" required></div>
                        <div class="form-group"><label>Senha</label><div style="position:relative;"><input type="password" id="cadastroPassword" required minlength="6" style="padding-right:45px;"><button type="button" onclick="togglePassword('cadastroPassword')" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:#666;"><i class="fas fa-eye"></i></button></div></div>
                        <button type="submit" class="btn-primary"><i class="fas fa-user-plus"></i> Cadastrar</button>
                    </form>
                    <div class="login-links"><a href="#" onclick="showLogin()">J√° tenho conta</a></div>
                </div>
            </div>
        </div>
        <div id="pageDashboard" class="page">
            <div class="stats-container">
                <div class="stat-card total" onclick="filterByCard('total')"><div class="icon"><i class="fas fa-clipboard-list"></i></div><div class="numero" id="totalPontos">76</div><div class="numero-filtrado" id="totalFiltrado"></div><div class="label">Total de Pontos</div></div>
                <div class="stat-card alta" onclick="filterByCard('ALTA')"><div class="icon"><i class="fas fa-exclamation-triangle"></i></div><div class="numero" id="totalAlta">37</div><div class="numero-filtrado" id="altaFiltrado"></div><div class="label">Criticidade Alta</div></div>
                <div class="stat-card media" onclick="filterByCard('M√âDIA')"><div class="icon"><i class="fas fa-exclamation-circle"></i></div><div class="numero" id="totalMedia">32</div><div class="numero-filtrado" id="mediaFiltrado"></div><div class="label">Criticidade M√©dia</div></div>
                <div class="stat-card baixa" onclick="filterByCard('BAIXA')"><div class="icon"><i class="fas fa-info-circle"></i></div><div class="numero" id="totalBaixa">7</div><div class="numero-filtrado" id="baixaFiltrado"></div><div class="label">Criticidade Baixa</div></div>
            </div>
            <section class="filters-section">
                <h3><i class="fas fa-filter"></i> Filtros</h3>
                <div class="filters-grid">
                    <div class="filter-group"><label>Hotel</label><select id="filterHotel"><option value="">Todos</option><option value="Brasil 21 Convention">Convention</option><option value="Brasil 21 Su√≠tes">Su√≠tes</option><option value="Meli√° Brasil 21">Meli√°</option><option value="Todos os Hot√©is">Todos</option></select></div>
                    <div class="filter-group"><label>Categoria</label><select id="filterCategoria"><option value="">Todas</option><option value="CONT√ÅBIL">Cont√°bil</option><option value="CONTROLES">Controles</option><option value="FRAUDE/IRREGULARIDADE">Fraude</option><option value="OPERACIONAL">Operacional</option></select></div>
                    <div class="filter-group"><label>Criticidade</label><select id="filterCriticidade"><option value="">Todas</option><option value="ALTA">Alta</option><option value="M√âDIA">M√©dia</option><option value="BAIXA">Baixa</option></select></div>
                    <div class="filter-group"><label>Status</label><select id="filterStatus"><option value="">Todos</option><option value="Pendente">Pendente</option><option value="Em Andamento">Em Andamento</option><option value="Conclu√≠do">Conclu√≠do</option></select></div>
                    <div class="filter-group"><label>Respons√°vel</label><select id="filterResponsavel"><option value="">Todos</option></select></div>
                    <div class="filter-group"><label>Buscar</label><input type="text" id="filterBusca" placeholder="Palavra-chave..."></div>
                    <div class="filter-buttons"><button class="btn-filter primary" onclick="aplicarFiltros()"><i class="fas fa-search"></i> Filtrar</button><button class="btn-filter secondary" onclick="limparFiltros()"><i class="fas fa-times"></i> Limpar</button></div>
                </div>
            </section>
            <div class="table-container">
                <div class="table-header"><h3><i class="fas fa-list"></i> Pontos de Auditoria</h3><span class="results-count"><span id="countFiltrado">76</span> de 76</span></div>
                <div style="overflow-x:auto;"><table><thead><tr><th>ID</th><th>Categoria</th><th>Subcategoria</th><th>Hotel</th><th>Crit.</th><th>Status</th><th>Respons√°vel</th><th>A√ß√µes</th></tr></thead><tbody id="tabelaPontos"></tbody></table></div>
            </div>
        </div>
        <div id="pageAcompanhamento" class="page">
            <h2 style="color:var(--azul-marinho);margin-bottom:20px;"><i class="fas fa-chart-pie"></i> Dashboard de Acompanhamento</h2>
            <div class="dashboard-filter"><label><i class="fas fa-filter"></i> Status:</label><select id="filterStatusAcomp" onchange="filtroAtivo={tipo:null,valor:null};atualizarGraficosAcompanhamento()"><option value="">Todos</option><option value="Pendente">Pendente</option><option value="Em Andamento">Em Andamento</option><option value="Conclu√≠do">Conclu√≠do</option></select><button onclick="filtroAtivo={tipo:null,valor:null};atualizarGraficosAcompanhamento();" style="margin-left:10px;padding:5px 15px;background:var(--vermelho);color:white;border:none;border-radius:5px;cursor:pointer;font-size:0.85rem;"><i class="fas fa-times"></i> Limpar Filtro</button><span id="totalFiltradoAcomp" style="margin-left:auto;font-weight:600;color:var(--dourado);"></span></div>
            <div class="charts-grid">
                <div class="chart-card"><h4><i class="fas fa-folder"></i> Por Categoria</h4><div class="chart-wrapper"><canvas id="chartCategoria"></canvas></div></div>
                <div class="chart-card"><h4><i class="fas fa-building"></i> Por Hotel</h4><div class="chart-wrapper"><canvas id="chartHotel"></canvas></div></div>
                <div class="chart-card"><h4><i class="fas fa-exclamation-circle"></i> Por Criticidade</h4><div class="chart-wrapper"><canvas id="chartCriticidade"></canvas></div></div>
            </div>
            <div class="charts-grid">
                <div class="chart-card"><h4><i class="fas fa-user-tie"></i> Por Respons√°vel</h4><div class="chart-wrapper-bar"><canvas id="chartResponsavel"></canvas></div></div>
                <div class="chart-card"><h4><i class="fas fa-clock"></i> Tempo em Aberto</h4><div class="chart-wrapper-bar"><canvas id="chartAtraso"></canvas></div></div>
            </div>
            <div class="chart-card" style="margin-top:20px;">
                <h4 style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
                    <span><i class="fas fa-project-diagram"></i> Cronograma do Processo (Gantt)</span>
                    <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                        <select id="filtroGanttTipo" style="padding:5px;border-radius:5px;font-size:0.8rem;" onchange="renderizarGantt()">
                            <option value="">Todos os tipos</option>
                            <option value="visita">Visita</option>
                            <option value="entrega">Entrega</option>
                            <option value="email">E-mail</option>
                            <option value="reuniao">Reuni√£o</option>
                            <option value="prazo">Prazo</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                </h4>
                <div class="gantt-legenda" style="display:flex;gap:20px;margin:10px 0;font-size:0.75rem;flex-wrap:wrap;">
                    <span><span style="display:inline-block;width:12px;height:12px;background:#2e7d32;border-radius:2px;margin-right:5px;"></span> Visita</span>
                    <span><span style="display:inline-block;width:12px;height:12px;background:#1565c0;border-radius:2px;margin-right:5px;"></span> Entrega</span>
                    <span><span style="display:inline-block;width:12px;height:12px;background:#ef6c00;border-radius:2px;margin-right:5px;"></span> E-mail</span>
                    <span><span style="display:inline-block;width:12px;height:12px;background:#7b1fa2;border-radius:2px;margin-right:5px;"></span> Reuni√£o</span>
                    <span><span style="display:inline-block;width:12px;height:12px;background:#c62828;border-radius:2px;margin-right:5px;"></span> Prazo</span>
                    <span><span style="display:inline-block;width:12px;height:12px;background:#546e7a;border-radius:2px;margin-right:5px;"></span> Outro</span>
                </div>
                <div id="ganttContainer" style="overflow-x:auto;"></div>
            </div>
        </div>
        <div id="pageRelatorios" class="page">
            <h2 style="color:var(--azul-marinho);margin-bottom:5px;"><i class="fas fa-file-pdf"></i> Relat√≥rios de Auditoria</h2>
            <p style="color:#666;margin-bottom:20px;">Base: Agosto/2025 | Visita: 06 a 10/10/2025</p>
            <div class="filters-section" style="margin-bottom:20px;">
                <div style="display:flex;gap:15px;align-items:center;flex-wrap:wrap;">
                    <div class="filter-group" style="flex:1;min-width:250px;">
                        <label><i class="fas fa-search"></i> Buscar nos Pontos</label>
                        <input type="text" id="filterRelatorios" placeholder="Digite palavra-chave..." oninput="filtrarRelatorios()">
                    </div>
                    <div style="padding-top:20px;">
                        <button class="btn-filter secondary" onclick="limparFiltroRelatorios()"><i class="fas fa-times"></i> Limpar</button>
                    </div>
                    <span id="resultadoBuscaRel" style="padding-top:20px;color:var(--dourado);font-weight:600;"></span>
                </div>
            </div>
            <div class="relatorios-grid" id="relatoriosGrid"></div>
        </div>
        <div id="pageAdmin" class="page">
            <div style="background:var(--azul-marinho);color:#fff;padding:15px 20px;border-radius:10px;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
                <h2 style="margin:0;font-size:1.3rem;"><i class="fas fa-cogs"></i> Painel Administrativo</h2>
                <div style="display:flex;gap:10px;align-items:center;">
                    <label style="font-size:0.8rem;display:flex;align-items:center;gap:5px;cursor:pointer;">
                        <input type="checkbox" id="chkMostrarAvancado" onchange="toggleSecoesAvancadas()">
                        Mostrar fun√ß√µes avan√ßadas
                    </label>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 onclick="toggleSecaoAdmin('secDocumentos')" style="cursor:pointer;"><i class="fas fa-folder-plus"></i> Gerenciamento de Documentos <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secDocumentos">
                    <p style="font-size:0.85rem;color:#666;margin-bottom:15px;">Adicione novos documentos (e-mails, PDFs, comprovantes) relacionados ao acompanhamento.</p>
                    <div class="admin-buttons">
                        <button class="btn-admin primary" onclick="abrirModalNovoDocumento()"><i class="fas fa-plus"></i> Novo Documento</button>
                        <button class="btn-admin success" onclick="listarDocumentos()"><i class="fas fa-list"></i> Ver Documentos</button>
                    </div>
                    <div id="listaDocumentosAdmin" style="margin-top:15px;"></div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 onclick="toggleSecaoAdmin('secEventos')" style="cursor:pointer;"><i class="fas fa-calendar-alt"></i> Timeline de Eventos <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secEventos">
                    <p style="font-size:0.85rem;color:#666;margin-bottom:15px;">Gerencie os marcos e eventos do processo de auditoria.</p>
                    <div class="admin-buttons">
                        <button class="btn-admin primary" onclick="abrirModalNovoEvento()"><i class="fas fa-plus"></i> Novo Evento</button>
                        <button class="btn-admin success" onclick="listarEventos()"><i class="fas fa-list"></i> Ver Eventos</button>
                    </div>
                    <div id="listaEventosAdmin" style="margin-top:15px;"></div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 onclick="toggleSecaoAdmin('secBackup')" style="cursor:pointer;"><i class="fas fa-shield-alt"></i> Backup do Sistema <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secBackup">
                    <p style="font-size:0.85rem;color:#666;margin-bottom:15px;">Gera um arquivo JSON com todos os dados: pontos de auditoria, coordenadas PDF, documentos e usu√°rios.</p>
                    <div class="admin-buttons">
                        <button class="btn-admin success" onclick="gerarBackupCompleto()"><i class="fas fa-download"></i> Gerar Backup Completo</button>
                        <button class="btn-admin primary" onclick="document.getElementById('inputRestaurar').click()"><i class="fas fa-upload"></i> Restaurar Backup</button>
                        <input type="file" id="inputRestaurar" accept=".json" style="display:none" onchange="restaurarBackup(event)">
                    </div>
                    <div id="statusBackup" style="margin-top:10px;font-size:0.85rem;"></div>
                </div>
            </div>
            
            <div class="admin-section">
                <h3 onclick="toggleSecaoAdmin('secUsuarios')" style="cursor:pointer;"><i class="fas fa-users"></i> Gerenciamento de Usu√°rios <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secUsuarios">
                    <h4 style="color:var(--azul-claro);margin:15px 0 10px;font-size:0.95rem;"><i class="fas fa-user-clock"></i> Usu√°rios Pendentes</h4>
                    <div id="usuariosPendentes"><p style="color:#666;">Carregando...</p></div>
                    <h4 style="color:var(--verde);margin:20px 0 10px;font-size:0.95rem;"><i class="fas fa-user-check"></i> Usu√°rios Aprovados</h4>
                    <div id="usuariosAprovados"><p style="color:#666;">Carregando...</p></div>
                </div>
            </div>
            
            <!-- SE√á√ïES AVAN√áADAS - Ocultas por padr√£o -->
            <div class="admin-section secao-avancada" style="display:none;border:2px dashed #ffc107;">
                <h3 onclick="toggleSecaoAdmin('secDados')" style="cursor:pointer;"><i class="fas fa-database"></i> Gerenciamento de Dados <span style="background:#ffc107;color:#000;padding:2px 8px;border-radius:10px;font-size:0.7rem;margin-left:10px;">Avan√ßado</span> <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secDados">
                    <p style="font-size:0.85rem;color:#c00;margin-bottom:15px;"><i class="fas fa-exclamation-triangle"></i> Cuidado: Estas fun√ß√µes afetam todos os dados do sistema.</p>
                    <div class="admin-buttons">
                        <button class="btn-admin primary" onclick="carregarDados118()"><i class="fas fa-upload"></i> Carregar 118 Pontos</button>
                        <button class="btn-admin success" onclick="exportarDados()"><i class="fas fa-download"></i> Exportar</button>
                        <button class="btn-admin danger" onclick="limparDados()"><i class="fas fa-trash"></i> Limpar</button>
                    </div>
                </div>
            </div>
            
            <div class="admin-section secao-avancada" style="display:none;border:2px dashed #ffc107;">
                <h3 onclick="toggleSecaoAdmin('secDatasPAs')" style="cursor:pointer;"><i class="fas fa-clock"></i> Atualizar Datas dos PAs <span style="background:#ffc107;color:#000;padding:2px 8px;border-radius:10px;font-size:0.7rem;margin-left:10px;">Avan√ßado</span> <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secDatasPAs">
                    <p style="font-size:0.85rem;color:#666;margin-bottom:15px;">Defina data de in√≠cio e previs√£o de conclus√£o para todos os PAs de uma vez.</p>
                    <div class="admin-buttons">
                        <button class="btn-admin primary" onclick="atualizarDatasTodosPAs()"><i class="fas fa-calendar-check"></i> Definir Datas (todos os 118 PAs)</button>
                    </div>
                </div>
            </div>
            
            <div class="admin-section secao-avancada" style="display:none;border:2px dashed #ffc107;">
                <h3 onclick="toggleSecaoAdmin('secEventosIniciais')" style="cursor:pointer;"><i class="fas fa-magic"></i> Carregar Eventos Iniciais <span style="background:#ffc107;color:#000;padding:2px 8px;border-radius:10px;font-size:0.7rem;margin-left:10px;">Avan√ßado</span> <i class="fas fa-chevron-down" style="float:right;font-size:0.8rem;"></i></h3>
                <div id="secEventosIniciais">
                    <p style="font-size:0.85rem;color:#666;margin-bottom:15px;">Cria os 4 eventos iniciais da timeline (Visita, Entrega, E-mail, Prazo).</p>
                    <div class="admin-buttons">
                        <button class="btn-admin" onclick="carregarEventosIniciais()" style="background:var(--dourado);"><i class="fas fa-magic"></i> Carregar Eventos Iniciais</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="modalDetalhes"><div class="modal-content"><div class="modal-header"><h3><i class="fas fa-info-circle"></i> <span id="modalTitulo">Detalhes</span></h3><button class="btn-close" onclick="fecharModal()">&times;</button></div><div class="modal-body" id="modalBody"></div></div></div>
    <div class="pdf-viewer" id="pdfViewer"><div class="pdf-viewer-header"><h3><i class="fas fa-file-pdf"></i> <span id="pdfTitulo">Relat√≥rio</span><span id="pdfBuscaRef" style="margin-left:15px;font-size:0.8rem;background:var(--dourado);color:var(--azul-marinho);padding:3px 10px;border-radius:10px;display:none;"></span></h3><button class="btn-voltar" onclick="fecharPdfViewer()"><i class="fas fa-arrow-left"></i> Voltar</button></div><div class="pdf-viewer-content"><iframe id="pdfEmbed" class="pdf-embed"></iframe><div class="pdf-sidebar"><h4><i class="fas fa-link"></i> Pontos Vinculados</h4><div id="pdfPontosVinculados"></div></div></div></div>
    <div class="pdf-viewer-modal" id="pdfViewerModal">
        <div class="pdf-viewer-container">
            <div class="pdf-sidebar-new">
                <div class="pdf-sidebar-header">
                    <h3 id="pdfViewerTitulo">Relat√≥rio</h3>
                    <button class="pdf-sidebar-close" onclick="fecharPdfViewerNew()">&times;</button>
                </div>
                <div class="pdf-pontos-list" id="pdfPontosListNew"></div>
            </div>
            <div class="pdf-main">
                <div class="pdf-controls">
                    <span class="pdf-status" id="pdfStatus">Carregando...</span>
                    <button onclick="pdfPrevPage()">‚óÄ Anterior</button>
                    <span>P√°gina <span id="pdfPageNum">1</span> de <span id="pdfPageCount">?</span></span>
                    <button onclick="pdfNextPage()">Pr√≥xima ‚ñ∂</button>
                    <button onclick="pdfZoomOut()">‚àí</button>
                    <span id="pdfZoomLevel">130%</span>
                    <button onclick="pdfZoomIn()">+</button>
                    <span style="margin-left:20px;border-left:2px solid #ccc;padding-left:20px;" id="editControls">
                        <button id="btnEditMode" onclick="toggleEditMode()" style="background:var(--laranja);">‚úèÔ∏è Editar Posi√ß√£o</button>
                        <button id="btnSaveCoords" onclick="salvarCoordenadas()" style="background:var(--verde);display:none;">üíæ Salvar</button>
                        <button id="btnCancelEdit" onclick="cancelarEdicao()" style="background:var(--vermelho);display:none;">‚úñ Cancelar</button>
                        <span id="coordsDisplay" style="font-size:0.75rem;color:#666;display:none;margin-left:10px;"></span>
                    </span>
                </div>
                <div id="pdfViewerPages"></div>
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script>
        firebase.initializeApp({apiKey:"AIzaSyCTbmISSnRTr_s9-gwnvSoP6ciGEFHuTYc",authDomain:"auditoria-brasil21.firebaseapp.com",projectId:"auditoria-brasil21",storageBucket:"auditoria-brasil21.firebasestorage.app",messagingSenderId:"836400128178",appId:"1:836400128178:web:ea676ceb7409793ae9e9ab"});
        const auth=firebase.auth(),db=firebase.firestore();
        let pontosAuditoria=[],pontosFiltrados=[],currentUser=null;
        let chartCategoria,chartHotel,chartCriticidade,chartResponsavel,chartAtraso;
        const ADMIN_EMAIL='vanjivaldo.silva@complexobrasil21.com.br';
        const DATA_BASE=new Date('2025-10-24');
        const RELATORIOS={
            "REL-01":{id:"REL-01",nome:"Cont√°bil Convention",arquivo:"REL-01_Contabil_Convention.pdf",categoria:"CONT√ÅBIL",hotel:"Brasil 21 Convention",paginas:7},
            "REL-02":{id:"REL-02",nome:"Cont√°bil Meli√°",arquivo:"REL-02_Contabil_Melia.pdf",categoria:"CONT√ÅBIL",hotel:"Meli√° Brasil 21",paginas:7},
            "REL-03":{id:"REL-03",nome:"Cont√°bil Su√≠tes",arquivo:"REL-03_Contabil_Suites.pdf",categoria:"CONT√ÅBIL",hotel:"Brasil 21 Su√≠tes",paginas:8},
            "REL-04":{id:"REL-04",nome:"Recep√ß√£o",arquivo:"REL-04_Processos_Recepcao.pdf",categoria:"OPERACIONAL",hotel:"Todos os Hot√©is",paginas:7},
            "REL-05":{id:"REL-05",nome:"Eventos",arquivo:"REL-05_Processos_Eventos.pdf",categoria:"OPERACIONAL",hotel:"Todos os Hot√©is",paginas:4},
            "REL-06":{id:"REL-06",nome:"Grupos",arquivo:"REL-06_Processos_Grupos.pdf",categoria:"OPERACIONAL",hotel:"Todos os Hot√©is",paginas:4},
            "REL-07":{id:"REL-07",nome:"Reservas",arquivo:"REL-07_Processos_Reservas.pdf",categoria:"OPERACIONAL",hotel:"Todos os Hot√©is",paginas:5},
            "REL-08":{id:"REL-08",nome:"Estornos",arquivo:"REL-08_Processos_Estornos.pdf",categoria:"CONTROLES",hotel:"Todos os Hot√©is",paginas:7},
            "REL-09":{id:"REL-09",nome:"Caso Alex",arquivo:"REL-09_Caso_Alex.pdf",categoria:"FRAUDE/IRREGULARIDADE",hotel:"Todos os Hot√©is",paginas:6}
        };
        const DADOS_118_PONTOS=[
{id:"PA-001",categoria:"CONT√ÅBIL",subcategoria:"111.01.001",hotel:"Brasil 21 Convention",ponto:"FUNDO DE CAIXA FIXO POOL",criticidade:"M√âDIA",recomendacao:"Verificar saldo e conciliar",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"1"},
{id:"PA-002",categoria:"CONT√ÅBIL",subcategoria:"111.01.002",hotel:"Brasil 21 Convention",ponto:"CAIXA TRANSIT√ìRIO",criticidade:"M√âDIA",recomendacao:"Depositar 2x/semana",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"1"},
{id:"PA-003",categoria:"CONT√ÅBIL",subcategoria:"112.01.002",hotel:"Brasil 21 Convention",ponto:"POSI√á√ÉO POR CLIENTES",criticidade:"ALTA",recomendacao:"Plano de cobran√ßa",responsavel:"Controladoria/Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"2"},
{id:"PA-004",categoria:"CONT√ÅBIL",subcategoria:"115.01.002",hotel:"Brasil 21 Convention",ponto:"DEVEDORES DUVIDOSOS",criticidade:"ALTA",recomendacao:"Provisionar adequadamente",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"2"},
{id:"PA-005",categoria:"CONT√ÅBIL",subcategoria:"117.01.003",hotel:"Brasil 21 Convention",ponto:"COFINS RETIDO",criticidade:"ALTA",recomendacao:"Acionar assessoria fiscal",responsavel:"Controladoria/Fiscal",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"3"},
{id:"PA-006",categoria:"CONT√ÅBIL",subcategoria:"117.01.013",hotel:"Brasil 21 Convention",ponto:"IRPJ PAGO A MAIOR",criticidade:"ALTA",recomendacao:"Acionar assessoria fiscal",responsavel:"Controladoria/Fiscal",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"3"},
{id:"PA-007",categoria:"CONT√ÅBIL",subcategoria:"119.01.003",hotel:"Brasil 21 Convention",ponto:"OUTRAS DESPESAS ANTECIPADAS",criticidade:"M√âDIA",recomendacao:"Conciliar e apropriar",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"4"},
{id:"PA-008",categoria:"CONT√ÅBIL",subcategoria:"119.01.005",hotel:"Brasil 21 Convention",ponto:"TX. DE CONDOM√çNIO ANTECIPADA",criticidade:"M√âDIA",recomendacao:"Regularizar antecipa√ß√£o",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"4"},
{id:"PA-009",categoria:"CONT√ÅBIL",subcategoria:"211.01.001",hotel:"Brasil 21 Convention",ponto:"FORNECEDORES",criticidade:"M√âDIA",recomendacao:"Conciliar saldos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"4"},
{id:"PA-010",categoria:"CONT√ÅBIL",subcategoria:"211.01.002",hotel:"Brasil 21 Convention",ponto:"PRESTADORES DE SERVI√áOS",criticidade:"M√âDIA",recomendacao:"Conciliar saldos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"4"},
{id:"PA-011",categoria:"CONT√ÅBIL",subcategoria:"211.04.001",hotel:"Brasil 21 Convention",ponto:"CONTAS A PAGAR INTERCOMPANHIA",criticidade:"M√âDIA",recomendacao:"Regularizar diferen√ßas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"5"},
{id:"PA-012",categoria:"CONT√ÅBIL",subcategoria:"211.05.007",hotel:"Brasil 21 Convention",ponto:"PROVIS√ÉO PARA PUBLICIDADE",criticidade:"BAIXA",recomendacao:"Avaliar utiliza√ß√£o",responsavel:"Marketing/Vendas",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"5"},
{id:"PA-013",categoria:"CONT√ÅBIL",subcategoria:"213.01.001",hotel:"Brasil 21 Convention",ponto:"IRPJ",criticidade:"ALTA",recomendacao:"Concilia√ß√£o emergencial",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"5"},
{id:"PA-014",categoria:"CONT√ÅBIL",subcategoria:"215.01.001",hotel:"Brasil 21 Convention",ponto:"DEPOSITOS ANTECIPADOS CLIENTES",criticidade:"ALTA",recomendacao:"Conciliar e identificar",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"6"},
{id:"PA-015",categoria:"CONT√ÅBIL",subcategoria:"215.01.002",hotel:"Brasil 21 Convention",ponto:"DEPOSITOS A IDENTIFICAR",criticidade:"M√âDIA",recomendacao:"Identificar e alocar",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"6"},
{id:"PA-016",categoria:"CONT√ÅBIL",subcategoria:"215.01.003",hotel:"Brasil 21 Convention",ponto:"VALORES PENDENTES REGULARIZAR",criticidade:"ALTA",recomendacao:"Regularizar urgente",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"6"},
{id:"PA-017",categoria:"CONT√ÅBIL",subcategoria:"216.01.004",hotel:"Brasil 21 Convention",ponto:"DIVIDENDOS",criticidade:"M√âDIA",recomendacao:"Conciliar contas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"6"},
{id:"PA-018",categoria:"CONT√ÅBIL",subcategoria:"216.02.006",hotel:"Brasil 21 Convention",ponto:"REPASSE RECEITAS CONDOM√çNIO",criticidade:"M√âDIA",recomendacao:"Conciliar repasses",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"6"},
{id:"PA-019",categoria:"CONT√ÅBIL",subcategoria:"216.02.008",hotel:"Brasil 21 Convention",ponto:"REPASSE RECEITA A&B",criticidade:"BAIXA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"7"},
{id:"PA-020",categoria:"CONT√ÅBIL",subcategoria:"216.02.012",hotel:"Brasil 21 Convention",ponto:"REPASSE DESPESAS PESSOAL",criticidade:"M√âDIA",recomendacao:"Conciliar repasses",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"7"},
{id:"PA-021",categoria:"CONT√ÅBIL",subcategoria:"223.04.001",hotel:"Brasil 21 Convention",ponto:"FUNDO DE RESERVA",criticidade:"ALTA",recomendacao:"Regularizar lastro",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"7"},
{id:"PA-022",categoria:"CONT√ÅBIL",subcategoria:"292.03.004",hotel:"Brasil 21 Convention",ponto:"ANTECIPA√á√ÉO LUCRO SCP",criticidade:"M√âDIA",recomendacao:"Conciliar distribui√ß√£o",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-01"],pagina_ref:"7"},
{id:"PA-023",categoria:"CONT√ÅBIL",subcategoria:"111.01.001",hotel:"Meli√° Brasil 21",ponto:"FUNDO DE CAIXA FIXO POOL",criticidade:"M√âDIA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"1"},
{id:"PA-024",categoria:"CONT√ÅBIL",subcategoria:"111.01.002",hotel:"Meli√° Brasil 21",ponto:"CAIXA TRANSIT√ìRIO",criticidade:"M√âDIA",recomendacao:"Depositar 2x/semana",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"1"},
{id:"PA-025",categoria:"CONT√ÅBIL",subcategoria:"111.03.008",hotel:"Meli√° Brasil 21",ponto:"BANCO SANTANDER FDO RESERVA",criticidade:"M√âDIA",recomendacao:"Conciliar aplica√ß√µes",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"2"},
{id:"PA-026",categoria:"CONT√ÅBIL",subcategoria:"111.03.019",hotel:"Meli√° Brasil 21",ponto:"BANCO SANTANDER DIVERSAS",criticidade:"M√âDIA",recomendacao:"Conciliar aplica√ß√µes",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"2"},
{id:"PA-027",categoria:"CONT√ÅBIL",subcategoria:"112.01.001",hotel:"Meli√° Brasil 21",ponto:"HOSPEDES NO HOTEL",criticidade:"ALTA",recomendacao:"Monitorar saldos",responsavel:"Recep√ß√£o/Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"2"},
{id:"PA-028",categoria:"CONT√ÅBIL",subcategoria:"112.01.002",hotel:"Meli√° Brasil 21",ponto:"POSI√á√ÉO POR CLIENTES",criticidade:"ALTA",recomendacao:"Plano de cobran√ßa",responsavel:"Controladoria/Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"2"},
{id:"PA-029",categoria:"CONT√ÅBIL",subcategoria:"112.01.007",hotel:"Meli√° Brasil 21",ponto:"FATURAMENTO EM TR√ÇNSITO",criticidade:"M√âDIA",recomendacao:"Regularizar pend√™ncias",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"3"},
{id:"PA-030",categoria:"CONT√ÅBIL",subcategoria:"113.03.001",hotel:"Meli√° Brasil 21",ponto:"ADIANTAMENTO FORNECEDORES",criticidade:"M√âDIA",recomendacao:"Conciliar adiantamentos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"3"},
{id:"PA-031",categoria:"CONT√ÅBIL",subcategoria:"115.01.002",hotel:"Meli√° Brasil 21",ponto:"DEVEDORES DUVIDOSOS",criticidade:"ALTA",recomendacao:"Provisionar adequadamente",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"3"},
{id:"PA-032",categoria:"CONT√ÅBIL",subcategoria:"117.01.003",hotel:"Meli√° Brasil 21",ponto:"COFINS RETIDO",criticidade:"ALTA",recomendacao:"Acionar assessoria fiscal",responsavel:"Controladoria/Fiscal",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"3"},
{id:"PA-033",categoria:"CONT√ÅBIL",subcategoria:"119.01.003",hotel:"Meli√° Brasil 21",ponto:"OUTRAS DESPESAS ANTECIPADAS",criticidade:"M√âDIA",recomendacao:"Conciliar e apropriar",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"4"},
{id:"PA-034",categoria:"CONT√ÅBIL",subcategoria:"119.01.005",hotel:"Meli√° Brasil 21",ponto:"TX. DE CONDOM√çNIO",criticidade:"M√âDIA",recomendacao:"Regularizar d√©ficit",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"4"},
{id:"PA-035",categoria:"CONT√ÅBIL",subcategoria:"211.01.002",hotel:"Meli√° Brasil 21",ponto:"PRESTADORES DE SERVI√áOS",criticidade:"M√âDIA",recomendacao:"Conciliar saldos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"4"},
{id:"PA-036",categoria:"CONT√ÅBIL",subcategoria:"211.01.003",hotel:"Meli√° Brasil 21",ponto:"REEMBOLSO DE FUNDOS",criticidade:"BAIXA",recomendacao:"Verificar pend√™ncias",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"4"},
{id:"PA-037",categoria:"CONT√ÅBIL",subcategoria:"211.04.001",hotel:"Meli√° Brasil 21",ponto:"CONTAS A PAGAR INTERCOMPANHIA",criticidade:"M√âDIA",recomendacao:"Regularizar diferen√ßas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"4"},
{id:"PA-038",categoria:"CONT√ÅBIL",subcategoria:"211.04.011",hotel:"Meli√° Brasil 21",ponto:"EMPRESAS GRUPO DIF C√ÇMBIO",criticidade:"M√âDIA",recomendacao:"Conciliar diferen√ßas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"5"},
{id:"PA-039",categoria:"CONT√ÅBIL",subcategoria:"211.05.007",hotel:"Meli√° Brasil 21",ponto:"PROVIS√ÉO PARA PUBLICIDADE",criticidade:"BAIXA",recomendacao:"Avaliar utiliza√ß√£o",responsavel:"Marketing/Vendas",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"5"},
{id:"PA-040",categoria:"CONT√ÅBIL",subcategoria:"211.05.009",hotel:"Meli√° Brasil 21",ponto:"PROVIS√ÉO DIVERSAS",criticidade:"BAIXA",recomendacao:"Verificar necessidade",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"5"},
{id:"PA-041",categoria:"CONT√ÅBIL",subcategoria:"213.01.003",hotel:"Meli√° Brasil 21",ponto:"ISS",criticidade:"ALTA",recomendacao:"Concilia√ß√£o emergencial",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"5"},
{id:"PA-042",categoria:"CONT√ÅBIL",subcategoria:"215.01.001",hotel:"Meli√° Brasil 21",ponto:"DEP√ìSITOS ANTECIPADOS",criticidade:"ALTA",recomendacao:"Conciliar e identificar",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"6"},
{id:"PA-043",categoria:"CONT√ÅBIL",subcategoria:"215.01.002",hotel:"Meli√° Brasil 21",ponto:"DEP√ìSITOS A IDENTIFICAR",criticidade:"M√âDIA",recomendacao:"Identificar e alocar",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"6"},
{id:"PA-044",categoria:"CONT√ÅBIL",subcategoria:"215.01.003",hotel:"Meli√° Brasil 21",ponto:"VALORES PENDENTES REGULARIZAR",criticidade:"ALTA",recomendacao:"Regularizar urgente",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"6"},
{id:"PA-045",categoria:"CONT√ÅBIL",subcategoria:"216.01.004",hotel:"Meli√° Brasil 21",ponto:"DIVIDENDOS",criticidade:"M√âDIA",recomendacao:"Conciliar contas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"6"},
{id:"PA-046",categoria:"CONT√ÅBIL",subcategoria:"216.02.008",hotel:"Meli√° Brasil 21",ponto:"REPASSE RECEITA A&B",criticidade:"BAIXA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"6"},
{id:"PA-047",categoria:"CONT√ÅBIL",subcategoria:"216.02.010",hotel:"Meli√° Brasil 21",ponto:"REPASSE DOA√á√ÉO WWF",criticidade:"BAIXA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"7"},
{id:"PA-048",categoria:"CONT√ÅBIL",subcategoria:"216.02.012",hotel:"Meli√° Brasil 21",ponto:"REPASSE DESPESAS PESSOAL",criticidade:"M√âDIA",recomendacao:"Conciliar repasses",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"7"},
{id:"PA-049",categoria:"CONT√ÅBIL",subcategoria:"223.04.001",hotel:"Meli√° Brasil 21",ponto:"FUNDO DE RESERVA",criticidade:"ALTA",recomendacao:"Regularizar lastro",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"7"},
{id:"PA-050",categoria:"CONT√ÅBIL",subcategoria:"292.03.004",hotel:"Meli√° Brasil 21",ponto:"ANTECIPA√á√ÉO LUCRO SCP",criticidade:"M√âDIA",recomendacao:"Conciliar distribui√ß√£o",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-02"],pagina_ref:"7"},
{id:"PA-051",categoria:"CONT√ÅBIL",subcategoria:"111.01.001",hotel:"Brasil 21 Su√≠tes",ponto:"FUNDO DE CAIXA FIXO POOL",criticidade:"M√âDIA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"1"},
{id:"PA-052",categoria:"CONT√ÅBIL",subcategoria:"111.01.002",hotel:"Brasil 21 Su√≠tes",ponto:"CAIXA TRANSIT√ìRIO",criticidade:"M√âDIA",recomendacao:"Depositar 2x/semana",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"1"},
{id:"PA-053",categoria:"CONT√ÅBIL",subcategoria:"112.01.002",hotel:"Brasil 21 Su√≠tes",ponto:"POSI√á√ÉO POR CLIENTES",criticidade:"ALTA",recomendacao:"Plano de cobran√ßa",responsavel:"Controladoria/Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"2"},
{id:"PA-054",categoria:"CONT√ÅBIL",subcategoria:"112.01.007",hotel:"Brasil 21 Su√≠tes",ponto:"FATURAMENTO EM TR√ÇNSITO",criticidade:"M√âDIA",recomendacao:"Regularizar pend√™ncias",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"2"},
{id:"PA-055",categoria:"CONT√ÅBIL",subcategoria:"113.03.001",hotel:"Brasil 21 Su√≠tes",ponto:"ADIANTAMENTO FORNECEDORES",criticidade:"M√âDIA",recomendacao:"Conciliar adiantamentos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"2"},
{id:"PA-056",categoria:"CONT√ÅBIL",subcategoria:"115.01.002",hotel:"Brasil 21 Su√≠tes",ponto:"DEVEDORES DUVIDOSOS",criticidade:"ALTA",recomendacao:"Provisionar adequadamente",responsavel:"Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"3"},
{id:"PA-057",categoria:"CONT√ÅBIL",subcategoria:"117.01.003",hotel:"Brasil 21 Su√≠tes",ponto:"COFINS RETIDO",criticidade:"ALTA",recomendacao:"Acionar assessoria fiscal",responsavel:"Controladoria/Fiscal",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"3"},
{id:"PA-058",categoria:"CONT√ÅBIL",subcategoria:"119.01.003",hotel:"Brasil 21 Su√≠tes",ponto:"OUTRAS DESPESAS ANTECIPADAS",criticidade:"M√âDIA",recomendacao:"Conciliar e apropriar",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"4"},
{id:"PA-059",categoria:"CONT√ÅBIL",subcategoria:"119.01.005",hotel:"Brasil 21 Su√≠tes",ponto:"TX. DE CONDOM√çNIO",criticidade:"M√âDIA",recomendacao:"Regularizar d√©ficit",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"4"},
{id:"PA-060",categoria:"CONT√ÅBIL",subcategoria:"211.01.001",hotel:"Brasil 21 Su√≠tes",ponto:"FORNECEDORES",criticidade:"M√âDIA",recomendacao:"Conciliar saldos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"4"},
{id:"PA-061",categoria:"CONT√ÅBIL",subcategoria:"211.01.002",hotel:"Brasil 21 Su√≠tes",ponto:"PRESTADORES DE SERVI√áOS",criticidade:"M√âDIA",recomendacao:"Conciliar saldos",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"5"},
{id:"PA-062",categoria:"CONT√ÅBIL",subcategoria:"211.01.003",hotel:"Brasil 21 Su√≠tes",ponto:"REEMBOLSO DE FUNDOS",criticidade:"BAIXA",recomendacao:"Verificar pend√™ncias",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"5"},
{id:"PA-063",categoria:"CONT√ÅBIL",subcategoria:"211.04.001",hotel:"Brasil 21 Su√≠tes",ponto:"CONTAS A PAGAR INTERCOMPANHIA",criticidade:"M√âDIA",recomendacao:"Regularizar diferen√ßas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"5"},
{id:"PA-064",categoria:"CONT√ÅBIL",subcategoria:"211.05.007",hotel:"Brasil 21 Su√≠tes",ponto:"PROVIS√ÉO PARA PUBLICIDADE",criticidade:"BAIXA",recomendacao:"Avaliar utiliza√ß√£o",responsavel:"Marketing/Vendas",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"5"},
{id:"PA-065",categoria:"CONT√ÅBIL",subcategoria:"213.01.004",hotel:"Brasil 21 Su√≠tes",ponto:"PIS",criticidade:"ALTA",recomendacao:"Concilia√ß√£o emergencial",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"6"},
{id:"PA-066",categoria:"CONT√ÅBIL",subcategoria:"215.01.001",hotel:"Brasil 21 Su√≠tes",ponto:"DEPOSITOS ANTECIPADOS",criticidade:"ALTA",recomendacao:"Conciliar e identificar",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"6"},
{id:"PA-067",categoria:"CONT√ÅBIL",subcategoria:"215.01.002",hotel:"Brasil 21 Su√≠tes",ponto:"DEPOSITOS A IDENTIFICAR",criticidade:"M√âDIA",recomendacao:"Identificar e alocar",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"6"},
{id:"PA-068",categoria:"CONT√ÅBIL",subcategoria:"215.01.003",hotel:"Brasil 21 Su√≠tes",ponto:"VALORES PENDENTES REGULARIZAR",criticidade:"ALTA",recomendacao:"Regularizar urgente",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"6"},
{id:"PA-069",categoria:"CONT√ÅBIL",subcategoria:"216.01.004",hotel:"Brasil 21 Su√≠tes",ponto:"DIVIDENDOS",criticidade:"M√âDIA",recomendacao:"Conciliar contas",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-070",categoria:"CONT√ÅBIL",subcategoria:"216.02.006",hotel:"Brasil 21 Su√≠tes",ponto:"REPASSE RECEITAS CONDOM√çNIO",criticidade:"M√âDIA",recomendacao:"Conciliar repasses",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-071",categoria:"CONT√ÅBIL",subcategoria:"216.02.008",hotel:"Brasil 21 Su√≠tes",ponto:"REPASSE RECEITA A&B",criticidade:"BAIXA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-072",categoria:"CONT√ÅBIL",subcategoria:"216.02.010",hotel:"Brasil 21 Su√≠tes",ponto:"REPASSE DOA√á√ÉO WWF",criticidade:"BAIXA",recomendacao:"Verificar saldo",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-073",categoria:"CONT√ÅBIL",subcategoria:"216.02.012",hotel:"Brasil 21 Su√≠tes",ponto:"REPASSE DESPESAS PESSOAL",criticidade:"M√âDIA",recomendacao:"Conciliar repasses",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-074",categoria:"CONT√ÅBIL",subcategoria:"223.04.001",hotel:"Brasil 21 Su√≠tes",ponto:"FUNDO DE RESERVA",criticidade:"ALTA",recomendacao:"Regularizar lastro",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-075",categoria:"CONT√ÅBIL",subcategoria:"223.04.002",hotel:"Brasil 21 Su√≠tes",ponto:"CAPITAL DE GIRO",criticidade:"M√âDIA",recomendacao:"Monitorar saldo",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"7"},
{id:"PA-076",categoria:"CONT√ÅBIL",subcategoria:"223.07.001",hotel:"Brasil 21 Su√≠tes",ponto:"CAU√á√ÉO",criticidade:"BAIXA",recomendacao:"Verificar composi√ß√£o",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"8"},
{id:"PA-077",categoria:"CONT√ÅBIL",subcategoria:"292.03.004",hotel:"Brasil 21 Su√≠tes",ponto:"ANTECIPA√á√ÉO LUCRO SCP",criticidade:"M√âDIA",recomendacao:"Conciliar distribui√ß√£o",responsavel:"Controladoria",prazo:"45 dias",status:"Pendente",relatorios:["REL-03"],pagina_ref:"8"},
{id:"PA-078",categoria:"OPERACIONAL",subcategoria:"Contas Pendentes",hotel:"Brasil 21 Convention",ponto:"Contas pendentes de encerramento",criticidade:"ALTA",recomendacao:"Encerrar em 5 dias",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"1"},
{id:"PA-079",categoria:"OPERACIONAL",subcategoria:"Contas Avulsas",hotel:"Brasil 21 Convention",ponto:"Contas avulsas abertas",criticidade:"ALTA",recomendacao:"Regularizar urgente",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"2"},
{id:"PA-080",categoria:"OPERACIONAL",subcategoria:"Saldos Elevados",hotel:"Brasil 21 Convention",ponto:"Valores acima de R$ 2.000",criticidade:"ALTA",recomendacao:"Analisar e cobrar",responsavel:"Recep√ß√£o/Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"3"},
{id:"PA-081",categoria:"OPERACIONAL",subcategoria:"Contas Limbo",hotel:"Brasil 21 Convention",ponto:"Contas sem movimenta√ß√£o",criticidade:"M√âDIA",recomendacao:"Rastrear e definir",responsavel:"Recep√ß√£o/Controladoria",prazo:"15 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"3"},
{id:"PA-082",categoria:"OPERACIONAL",subcategoria:"Contas Pendentes",hotel:"Brasil 21 Su√≠tes",ponto:"Contas pendentes de encerramento",criticidade:"ALTA",recomendacao:"Encerrar em 5 dias",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"4"},
{id:"PA-083",categoria:"OPERACIONAL",subcategoria:"Contas Avulsas",hotel:"Brasil 21 Su√≠tes",ponto:"Contas avulsas abertas",criticidade:"ALTA",recomendacao:"Regularizar urgente",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"4"},
{id:"PA-084",categoria:"OPERACIONAL",subcategoria:"Contas Limbo",hotel:"Brasil 21 Su√≠tes",ponto:"Contas sem movimenta√ß√£o",criticidade:"M√âDIA",recomendacao:"Rastrear e definir",responsavel:"Recep√ß√£o/Controladoria",prazo:"15 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"4"},
{id:"PA-085",categoria:"OPERACIONAL",subcategoria:"Saldos Elevados",hotel:"Brasil 21 Su√≠tes",ponto:"Valores acima de R$ 2.000",criticidade:"ALTA",recomendacao:"Analisar e cobrar",responsavel:"Recep√ß√£o/Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"4"},
{id:"PA-086",categoria:"OPERACIONAL",subcategoria:"Contas Pendentes",hotel:"Meli√° Brasil 21",ponto:"Contas pendentes de encerramento",criticidade:"ALTA",recomendacao:"Plano urgente",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"5"},
{id:"PA-087",categoria:"OPERACIONAL",subcategoria:"Contas Avulsas",hotel:"Meli√° Brasil 21",ponto:"Contas avulsas e irregulares",criticidade:"ALTA",recomendacao:"Regularizar urgente",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"5"},
{id:"PA-088",categoria:"OPERACIONAL",subcategoria:"Saldos Elevados",hotel:"Meli√° Brasil 21",ponto:"Valores acima de R$ 4.000",criticidade:"ALTA",recomendacao:"Analisar e cobrar",responsavel:"Recep√ß√£o/Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"6"},
{id:"PA-089",categoria:"OPERACIONAL",subcategoria:"Contas Limbo",hotel:"Meli√° Brasil 21",ponto:"Contas sem movimenta√ß√£o",criticidade:"M√âDIA",recomendacao:"Rastrear e definir",responsavel:"Recep√ß√£o/Controladoria",prazo:"15 dias",status:"Pendente",relatorios:["REL-04"],pagina_ref:"6"},
{id:"PA-090",categoria:"OPERACIONAL",subcategoria:"Evento Dale Carnegie",hotel:"Brasil 21 Convention",ponto:"Cr√©dito R$ 45.329,50",criticidade:"ALTA",recomendacao:"Resolver pend√™ncia",responsavel:"Eventos",prazo:"15 dias",status:"Pendente",relatorios:["REL-05"],pagina_ref:"1"},
{id:"PA-091",categoria:"OPERACIONAL",subcategoria:"Evento Academy Tarkett",hotel:"Brasil 21 Su√≠tes",ponto:"Pend√™ncia R$ 5.181,75",criticidade:"ALTA",recomendacao:"Cobrar valor",responsavel:"Eventos",prazo:"15 dias",status:"Pendente",relatorios:["REL-05"],pagina_ref:"2"},
{id:"PA-092",categoria:"OPERACIONAL",subcategoria:"Evento Dale Carnegie",hotel:"Meli√° Brasil 21",ponto:"Cr√©dito R$ 32.347,50",criticidade:"ALTA",recomendacao:"Resolver pend√™ncia",responsavel:"Eventos",prazo:"15 dias",status:"Pendente",relatorios:["REL-05"],pagina_ref:"2"},
{id:"PA-093",categoria:"OPERACIONAL",subcategoria:"NFs valores inferiores",hotel:"Brasil 21 Convention",ponto:"Discrep√¢ncia valores pagos",criticidade:"ALTA",recomendacao:"Verificar diferen√ßas",responsavel:"Grupos/Controladoria",prazo:"15 dias",status:"Pendente",relatorios:["REL-06"],pagina_ref:"2"},
{id:"PA-094",categoria:"OPERACIONAL",subcategoria:"Cr√©ditos de Grupos",hotel:"Brasil 21 Su√≠tes",ponto:"R$ 1.239,88 pagtos a maior",criticidade:"M√âDIA",recomendacao:"Devolver ou creditar",responsavel:"Grupos/Controladoria",prazo:"15 dias",status:"Pendente",relatorios:["REL-06"],pagina_ref:"2"},
{id:"PA-095",categoria:"OPERACIONAL",subcategoria:"Sem lan√ßamento cr√©dito",hotel:"Meli√° Brasil 21",ponto:"Pagamento n√£o registrado",criticidade:"ALTA",recomendacao:"Regularizar registro",responsavel:"Grupos/Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-06"],pagina_ref:"3"},
{id:"PA-096",categoria:"OPERACIONAL",subcategoria:"Contas Pendentes",hotel:"Brasil 21 Convention",ponto:"40 contas (atualizado 29)",criticidade:"ALTA",recomendacao:"Encerrar contas",responsavel:"Reservas",prazo:"10 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"2"},
{id:"PA-097",categoria:"OPERACIONAL",subcategoria:"Contas Avulsas",hotel:"Brasil 21 Convention",ponto:"Reservas avulsas",criticidade:"M√âDIA",recomendacao:"Regularizar",responsavel:"Reservas",prazo:"15 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"2"},
{id:"PA-098",categoria:"OPERACIONAL",subcategoria:"Contas em Limbo",hotel:"Brasil 21 Convention",ponto:"Reservas sem defini√ß√£o",criticidade:"M√âDIA",recomendacao:"Definir destino",responsavel:"Reservas",prazo:"15 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"2"},
{id:"PA-099",categoria:"OPERACIONAL",subcategoria:"70 contas pendentes",hotel:"Brasil 21 Su√≠tes",ponto:"20 outubro + antigas",criticidade:"ALTA",recomendacao:"Resolver pend√™ncias",responsavel:"Reservas",prazo:"10 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"3"},
{id:"PA-100",categoria:"OPERACIONAL",subcategoria:"Contas em Limbo",hotel:"Brasil 21 Su√≠tes",ponto:"Reservas sem defini√ß√£o",criticidade:"M√âDIA",recomendacao:"Definir destino",responsavel:"Reservas",prazo:"15 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"3"},
{id:"PA-101",categoria:"OPERACIONAL",subcategoria:"282 contas pendentes",hotel:"Meli√° Brasil 21",ponto:"57 antigas + 112 set + 113 out",criticidade:"ALTA",recomendacao:"Plano urgente",responsavel:"Reservas",prazo:"10 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"3"},
{id:"PA-102",categoria:"OPERACIONAL",subcategoria:"Contas em Limbo",hotel:"Meli√° Brasil 21",ponto:"Reservas sem defini√ß√£o",criticidade:"M√âDIA",recomendacao:"Definir destino",responsavel:"Reservas",prazo:"15 dias",status:"Pendente",relatorios:["REL-07"],pagina_ref:"3"},
{id:"PA-103",categoria:"CONTROLES",subcategoria:"Assinaturas",hotel:"Meli√° Brasil 21",ponto:"Estornos sem assinatura",criticidade:"M√âDIA",recomendacao:"Validar assinaturas",responsavel:"Controller/GG",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"1"},
{id:"PA-104",categoria:"CONTROLES",subcategoria:"Motivo dos estornos",hotel:"Meli√° Brasil 21",ponto:"Justificativas incompletas",criticidade:"ALTA",recomendacao:"Preencher motivos",responsavel:"Recep√ß√£o/Auditoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"1"},
{id:"PA-105",categoria:"CONTROLES",subcategoria:"Assinaturas",hotel:"Brasil 21 Convention",ponto:"Estornos com atraso",criticidade:"M√âDIA",recomendacao:"Assinar no prazo",responsavel:"Controller/GG",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"3"},
{id:"PA-106",categoria:"CONTROLES",subcategoria:"Utiliza√ß√£o de descontos",hotel:"Brasil 21 Convention",ponto:"Descontos sem justificativa",criticidade:"ALTA",recomendacao:"Documentar descontos",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"3"},
{id:"PA-107",categoria:"CONTROLES",subcategoria:"Motivos dos estornos",hotel:"Brasil 21 Convention",ponto:"Justificativas incompletas",criticidade:"ALTA",recomendacao:"Preencher motivos",responsavel:"Recep√ß√£o/Auditoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"4"},
{id:"PA-108",categoria:"CONTROLES",subcategoria:"Brasil 21 Su√≠tes ago/25",hotel:"Brasil 21 Su√≠tes",ponto:"An√°lise estornos agosto",criticidade:"M√âDIA",recomendacao:"Revisar processos",responsavel:"Controller",prazo:"15 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"5"},
{id:"PA-109",categoria:"CONTROLES",subcategoria:"Assinaturas",hotel:"Brasil 21 Su√≠tes",ponto:"Estornos sem assinatura",criticidade:"M√âDIA",recomendacao:"Validar assinaturas",responsavel:"Controller/GG",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"5"},
{id:"PA-110",categoria:"CONTROLES",subcategoria:"Utiliza√ß√£o de descontos",hotel:"Brasil 21 Su√≠tes",ponto:"Descontos sem justificativa",criticidade:"ALTA",recomendacao:"Documentar descontos",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"5"},
{id:"PA-111",categoria:"CONTROLES",subcategoria:"Motivos dos estornos",hotel:"Brasil 21 Su√≠tes",ponto:"Justificativas incompletas",criticidade:"ALTA",recomendacao:"Preencher motivos",responsavel:"Recep√ß√£o/Auditoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-08"],pagina_ref:"6"},
{id:"PA-112",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Prazo contas pendentes",hotel:"Todos os Hot√©is",ponto:"5 dias ind / 15 dias grupos",criticidade:"ALTA",recomendacao:"Cumprir prazos",responsavel:"Recep√ß√£o/Grupos",prazo:"10 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"5"},
{id:"PA-113",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Lan√ßamentos originais",hotel:"Todos os Hot√©is",ponto:"Evitar contas avulsas",criticidade:"ALTA",recomendacao:"Manter em contas originais",responsavel:"Recep√ß√£o",prazo:"10 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"5"},
{id:"PA-114",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Cr√©ditos sobra pagtos",hotel:"Todos os Hot√©is",ponto:"Devolver ou lan√ßar di√°ria",criticidade:"ALTA",recomendacao:"Devolver cr√©ditos",responsavel:"Recep√ß√£o/Controladoria",prazo:"10 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"6"},
{id:"PA-115",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Cr√©ditos > 6 meses",hotel:"Todos os Hot√©is",ponto:"Reconhecer como receita",criticidade:"ALTA",recomendacao:"Apropriar receita",responsavel:"Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"6"},
{id:"PA-116",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Rastrear di√°rias",hotel:"Todos os Hot√©is",ponto:"Transferir contas corretas",criticidade:"ALTA",recomendacao:"Identificar e alocar",responsavel:"Recep√ß√£o/Controladoria",prazo:"15 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"6"},
{id:"PA-117",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Integra√ß√£o Recep√ß√£o-Ctrl",hotel:"Todos os Hot√©is",ponto:"Pagtos antecipados e grupos",criticidade:"ALTA",recomendacao:"Melhorar comunica√ß√£o",responsavel:"Recep√ß√£o/Controladoria",prazo:"30 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"6"},
{id:"PA-118",categoria:"FRAUDE/IRREGULARIDADE",subcategoria:"Intera√ß√£o Recep√ß√£o-Audit",hotel:"Todos os Hot√©is",ponto:"Relat√≥rios semanais",criticidade:"ALTA",recomendacao:"Implementar reuni√µes",responsavel:"Controller/GG",prazo:"30 dias",status:"Pendente",relatorios:["REL-09"],pagina_ref:"6"}
];
        // PDF.js Config e Coordenadas
        pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        let pdfDoc=null,pdfScale=1.3,pdfCurrentPonto=null,pdfCurrentRel=null;
        const PONTOS_COORDS={"REL-01":[{id:"PA-001",pag:1,coords:{x:84.8,y:220.5,w:322.7,h:10.3}},{id:"PA-002",pag:1,coords:{x:84.8,y:451.4,w:289.9,h:10.3}},{id:"PA-003",pag:2,coords:{x:84.8,y:196.2,w:335.0,h:10.3}},{id:"PA-004",pag:2,coords:{x:84.8,y:573.5,w:316.8,h:10.3}},{id:"PA-005",pag:3,coords:{x:84.8,y:111.1,w:442.2,h:241.2}},{id:"PA-006",pag:3,coords:{x:84.8,y:366.3,w:442.1,h:229.1}},{id:"PA-007",pag:4,coords:{x:84.8,y:173.5,w:371.9,h:10.3}},{id:"PA-008",pag:4,coords:{x:84.8,y:343.6,w:440.9,h:10.3}},{id:"PA-009",pag:4,coords:{x:84.8,y:513.8,w:263.4,h:10.3}},{id:"PA-010",pag:4,coords:{x:84.8,y:586.8,w:345.2,h:10.3}},{id:"PA-011",pag:5,coords:{x:84.8,y:111.1,w:391.9,h:10.3}},{id:"PA-012",pag:5,coords:{x:84.8,y:232.6,w:359.8,h:10.3}},{id:"PA-013",pag:5,coords:{x:84.8,y:354.2,w:442.5,h:338.6}},{id:"PA-014",pag:6,coords:{x:84.8,y:244.8,w:395.2,h:10.3}},{id:"PA-015",pag:6,coords:{x:84.8,y:329.9,w:335.1,h:10.3}},{id:"PA-016",pag:6,coords:{x:84.8,y:427.1,w:442.5,h:22.4}},{id:"PA-017",pag:6,coords:{x:84.8,y:536.5,w:257.7,h:10.3}},{id:"PA-018",pag:6,coords:{x:84.8,y:633.8,w:390.6,h:10.3}},{id:"PA-019",pag:7,coords:{x:84.8,y:111.1,w:407.8,h:10.3}},{id:"PA-020",pag:7,coords:{x:84.8,y:184.0,w:371.9,h:10.3}},{id:"PA-021",pag:7,coords:{x:84.8,y:269.1,w:307.7,h:10.3}},{id:"PA-022",pag:7,coords:{x:84.8,y:342.0,w:442.5,h:22.4}}],"REL-02":[{id:"PA-023",pag:1,coords:{x:84.8,y:237.5,w:333.5,h:10.3}},{id:"PA-024",pag:1,coords:{x:84.8,y:577.9,w:297.0,h:10.3}},{id:"PA-025",pag:2,coords:{x:84.8,y:111.1,w:433.0,h:10.3}},{id:"PA-026",pag:2,coords:{x:84.8,y:171.9,w:409.0,h:10.3}},{id:"PA-027",pag:2,coords:{x:84.8,y:257.0,w:307.8,h:10.3}},{id:"PA-028",pag:2,coords:{x:84.8,y:305.6,w:334.9,h:10.3}},{id:"PA-029",pag:3,coords:{x:84.8,y:111.1,w:327.4,h:10.3}},{id:"PA-030",pag:3,coords:{x:84.8,y:171.9,w:366.1,h:10.3}},{id:"PA-031",pag:3,coords:{x:84.8,y:220.5,w:316.8,h:10.3}},{id:"PA-032",pag:3,coords:{x:84.8,y:366.3,w:330.8,h:180.5}},{id:"PA-033",pag:4,coords:{x:84.8,y:123.3,w:371.9,h:10.3}},{id:"PA-034",pag:4,coords:{x:84.8,y:293.4,w:442.6,h:22.4}},{id:"PA-035",pag:4,coords:{x:84.8,y:475.7,w:345.2,h:10.3}},{id:"PA-036",pag:4,coords:{x:84.8,y:548.7,w:315.3,h:10.3}},{id:"PA-037",pag:4,coords:{x:84.8,y:621.6,w:402.5,h:10.3}},{id:"PA-038",pag:5,coords:{x:84.8,y:171.9,w:414.0,h:10.3}},{id:"PA-039",pag:5,coords:{x:84.8,y:244.8,w:359.8,h:10.3}},{id:"PA-040",pag:5,coords:{x:84.8,y:354.2,w:297.8,h:10.3}},{id:"PA-041",pag:5,coords:{x:84.8,y:402.8,w:442.2,h:253.4}},{id:"PA-042",pag:6,coords:{x:84.8,y:184.0,w:386.7,h:10.3}},{id:"PA-043",pag:6,coords:{x:84.8,y:293.4,w:332.8,h:10.3}},{id:"PA-044",pag:6,coords:{x:84.8,y:390.7,w:442.5,h:22.4}},{id:"PA-045",pag:6,coords:{x:84.8,y:512.2,w:268.3,h:10.3}},{id:"PA-046",pag:6,coords:{x:84.8,y:609.5,w:414.9,h:10.3}},{id:"PA-047",pag:7,coords:{x:84.8,y:111.1,w:263.4,h:10.3}},{id:"PA-048",pag:7,coords:{x:84.8,y:184.0,w:379.0,h:10.3}},{id:"PA-049",pag:7,coords:{x:84.8,y:269.1,w:315.7,h:10.3}},{id:"PA-050",pag:7,coords:{x:84.8,y:342.0,w:442.5,h:22.4}}],"REL-03":[{id:"PA-051",pag:1,coords:{x:84.8,y:205.9,w:317.0,h:10.3}},{id:"PA-052",pag:1,coords:{x:84.8,y:449.0,w:292.0,h:10.3}},{id:"PA-053",pag:2,coords:{x:84.8,y:196.2,w:329.3,h:10.3}},{id:"PA-054",pag:2,coords:{x:84.8,y:573.5,w:323.1,h:10.3}},{id:"PA-055",pag:2,coords:{x:84.8,y:634.2,w:370.3,h:10.3}},{id:"PA-056",pag:3,coords:{x:84.8,y:111.1,w:312.4,h:10.3}},{id:"PA-057",pag:3,coords:{x:84.8,y:257.0,w:442.5,h:485.0}},{id:"PA-058",pag:4,coords:{x:84.8,y:282.3,w:371.9,h:10.3}},{id:"PA-059",pag:4,coords:{x:84.8,y:452.5,w:442.6,h:22.4}},{id:"PA-060",pag:4,coords:{x:84.8,y:646.9,w:265.4,h:10.3}},{id:"PA-061",pag:5,coords:{x:84.8,y:147.5,w:345.2,h:10.3}},{id:"PA-062",pag:5,coords:{x:84.8,y:220.5,w:291.2,h:10.3}},{id:"PA-063",pag:5,coords:{x:84.8,y:281.3,w:388.2,h:10.3}},{id:"PA-064",pag:5,coords:{x:84.8,y:402.8,w:355.5,h:10.3}},{id:"PA-065",pag:6,coords:{x:84.8,y:111.1,w:442.5,h:290.0}},{id:"PA-066",pag:6,coords:{x:84.8,y:415.0,w:391.0,h:10.3}},{id:"PA-067",pag:6,coords:{x:84.8,y:500.1,w:331.5,h:10.3}},{id:"PA-068",pag:6,coords:{x:84.8,y:597.3,w:442.5,h:22.4}},{id:"PA-069",pag:7,coords:{x:84.8,y:123.3,w:261.8,h:10.3}},{id:"PA-070",pag:7,coords:{x:84.8,y:220.5,w:386.3,h:10.3}},{id:"PA-071",pag:7,coords:{x:84.8,y:293.4,w:407.8,h:10.3}},{id:"PA-072",pag:7,coords:{x:84.8,y:366.3,w:255.4,h:10.3}},{id:"PA-073",pag:7,coords:{x:84.8,y:439.3,w:371.9,h:10.3}},{id:"PA-074",pag:7,coords:{x:84.8,y:524.3,w:315.7,h:10.3}},{id:"PA-075",pag:7,coords:{x:84.8,y:609.5,w:281.9,h:10.3}},{id:"PA-076",pag:8,coords:{x:84.8,y:111.1,w:233.5,h:10.3}},{id:"PA-077",pag:8,coords:{x:84.8,y:208.3,w:442.5,h:22.4}}],"REL-04":[{id:"PA-078",pag:1,coords:{x:84.9,y:563.9,w:114.7,h:12.4}},{id:"PA-079",pag:2,coords:{x:84.9,y:213.8,w:93.8,h:11.0}},{id:"PA-080",pag:3,coords:{x:84.9,y:447.4,w:297.0,h:11.0}},{id:"PA-081",pag:3,coords:{x:84.9,y:651.6,w:99.7,h:11.0}},{id:"PA-082",pag:4,coords:{x:84.9,y:155.0,w:114.7,h:11.0}},{id:"PA-083",pag:4,coords:{x:84.9,y:359.7,w:100.3,h:11.0}},{id:"PA-084",pag:4,coords:{x:84.9,y:534.5,w:99.7,h:11.0}},{id:"PA-085",pag:4,coords:{x:84.9,y:651.6,w:280.9,h:11.0}},{id:"PA-086",pag:5,coords:{x:84.9,y:286.5,w:114.7,h:11.0}},{id:"PA-087",pag:5,coords:{x:84.9,y:403.6,w:160.7,h:11.0}},{id:"PA-088",pag:6,coords:{x:84.9,y:286.5,w:297.0,h:11.0}},{id:"PA-089",pag:6,coords:{x:84.9,y:418.0,w:99.7,h:11.0}}],"REL-05":[{id:"PA-090",pag:1,coords:{x:84.9,y:637.2,w:442.0,h:55.0}},{id:"PA-091",pag:2,coords:{x:84.9,y:140.6,w:442.0,h:65.0}},{id:"PA-092",pag:2,coords:{x:84.9,y:374.2,w:442.0,h:55.0}}],"REL-06":[{id:"PA-093",pag:2,coords:{x:84.9,y:111.8,w:442.0,h:100.0}},{id:"PA-094",pag:2,coords:{x:84.9,y:403.6,w:442.0,h:75.0}},{id:"PA-095",pag:3,coords:{x:84.9,y:111.8,w:442.0,h:100.0}}],"REL-07":[{id:"PA-096",pag:2,coords:{x:84.9,y:330.3,w:442.0,h:65.0}},{id:"PA-097",pag:2,coords:{x:84.9,y:505.7,w:107.8,h:11.0}},{id:"PA-098",pag:2,coords:{x:84.9,y:622.1,w:113.5,h:11.0}},{id:"PA-099",pag:3,coords:{x:84.9,y:170.0,w:442.0,h:65.0}},{id:"PA-100",pag:3,coords:{x:84.9,y:403.6,w:113.5,h:11.0}},{id:"PA-101",pag:3,coords:{x:84.9,y:505.7,w:442.0,h:65.0}},{id:"PA-102",pag:3,coords:{x:84.9,y:637.2,w:105.6,h:11.0}}],"REL-08":[{id:"PA-103",pag:1,coords:{x:84.9,y:242.7,w:110.0,h:11.0}},{id:"PA-104",pag:1,coords:{x:84.9,y:374.0,w:160.0,h:11.0}},{id:"PA-105",pag:3,coords:{x:84.9,y:140.6,w:110.0,h:11.0}},{id:"PA-106",pag:3,coords:{x:84.9,y:286.5,w:175.0,h:11.0}},{id:"PA-107",pag:4,coords:{x:84.9,y:111.4,w:160.0,h:11.0}},{id:"PA-108",pag:5,coords:{x:84.9,y:403.2,w:210.0,h:11.0}},{id:"PA-109",pag:5,coords:{x:84.9,y:432.4,w:110.0,h:11.0}},{id:"PA-110",pag:5,coords:{x:84.9,y:578.2,w:175.0,h:11.0}},{id:"PA-111",pag:6,coords:{x:84.9,y:198.9,w:160.0,h:11.0}}],"REL-09":[{id:"PA-112",pag:5,coords:{x:84.9,y:503.9,w:442.0,h:45.0}},{id:"PA-113",pag:5,coords:{x:84.9,y:562.1,w:442.0,h:30.0}},{id:"PA-114",pag:6,coords:{x:84.9,y:170.0,w:442.0,h:90.0}},{id:"PA-115",pag:6,coords:{x:84.9,y:272.1,w:380.0,h:11.0}},{id:"PA-116",pag:6,coords:{x:84.9,y:315.9,w:442.0,h:45.0}},{id:"PA-117",pag:6,coords:{x:84.9,y:374.2,w:442.0,h:100.0}},{id:"PA-118",pag:6,coords:{x:84.9,y:491.2,w:442.0,h:110.0}}]};
        // AUTH
        auth.onAuthStateChanged(async user=>{
            if(user){
                // Verificar se e-mail est√° verificado
                if(!user.emailVerified && user.email !== ADMIN_EMAIL){
                    currentUser=null;document.body.classList.remove('logged-in');showLogin();
                    return;
                }
                // Verificar se est√° aprovado
                const userDoc=await db.collection('usuarios').doc(user.uid).get();
                if(userDoc.exists && !userDoc.data().aprovado && user.email !== ADMIN_EMAIL){
                    currentUser=null;document.body.classList.remove('logged-in');showLogin();
                    return;
                }
                // Tudo OK - carregar sistema
                currentUser=user;
                document.body.classList.add('logged-in');
                document.getElementById('userEmail').textContent=user.email;
                // Mostrar/ocultar bot√£o Admin (s√≥ para admin)
                const btnAdmin=document.getElementById('btnAdmin');
                if(btnAdmin){
                    if(user.email===ADMIN_EMAIL || (userDoc.exists && userDoc.data().role==='admin')){
                        btnAdmin.style.display='inline-block';
                    }else{
                        btnAdmin.style.display='none';
                    }
                }
                await carregarPontos();await carregarCoordenadasFirestore();preencherFiltros();atualizarEstatisticas();renderizarTabela();carregarRelatoriosGrid();carregarEventos();
                if(user.email===ADMIN_EMAIL || (userDoc.exists && userDoc.data().role==='admin')){carregarUsuarios();}
                showPage('acompanhamento');
            }
            else{currentUser=null;document.body.classList.remove('logged-in');showLogin();}
        });
        async function handleLogin(e){
            e.preventDefault();
            try{
                const res=await auth.signInWithEmailAndPassword(document.getElementById('loginEmail').value,document.getElementById('loginPassword').value);
                // Admin passa direto
                if(res.user.email===ADMIN_EMAIL){
                    return; // onAuthStateChanged vai cuidar do resto
                }
                if(!res.user.emailVerified){
                    await auth.signOut();
                    document.getElementById('loginAlert').innerHTML='<div class="alert alert-error"><i class="fas fa-envelope"></i> Verifique seu e-mail primeiro! <a href="#" onclick="reenviarVerificacao()" style="color:#721c24;text-decoration:underline;">Reenviar link</a></div>';
                    return;
                }
                const userDoc=await db.collection('usuarios').doc(res.user.uid).get();
                if(userDoc.exists){
                    await db.collection('usuarios').doc(res.user.uid).update({emailVerificado:true});
                    if(!userDoc.data().aprovado){
                        await auth.signOut();
                        document.getElementById('loginAlert').innerHTML='<div class="alert alert-error"><i class="fas fa-clock"></i> E-mail verificado! Aguarde aprova√ß√£o do administrador.</div>';
                        return;
                    }
                }
            }catch(err){document.getElementById('loginAlert').innerHTML='<div class="alert alert-error">E-mail ou senha incorretos</div>';}
        }
        async function reenviarVerificacao(){
            const email=document.getElementById('loginEmail').value;
            const senha=document.getElementById('loginPassword').value;
            if(!email||!senha){document.getElementById('loginAlert').innerHTML='<div class="alert alert-error">Preencha e-mail e senha para reenviar</div>';return;}
            try{
                const res=await auth.signInWithEmailAndPassword(email,senha);
                await res.user.sendEmailVerification();
                await auth.signOut();
                document.getElementById('loginAlert').innerHTML='<div class="alert alert-success"><i class="fas fa-check"></i> Link de verifica√ß√£o reenviado! Verifique sua caixa de entrada.</div>';
            }catch(err){document.getElementById('loginAlert').innerHTML='<div class="alert alert-error">Erro ao reenviar: '+err.message+'</div>';}
        }
        async function handleCadastro(e){
            e.preventDefault();
            const nome=document.getElementById('cadastroNome').value,email=document.getElementById('cadastroEmail').value,senha=document.getElementById('cadastroPassword').value;
            try{
                const res=await auth.createUserWithEmailAndPassword(email,senha);
                await res.user.sendEmailVerification();
                await db.collection('usuarios').doc(res.user.uid).set({nome,email,role:email===ADMIN_EMAIL?'admin':'user',aprovado:email===ADMIN_EMAIL,emailVerificado:false,solicitadoEm:firebase.firestore.FieldValue.serverTimestamp(),aprovadoEm:email===ADMIN_EMAIL?firebase.firestore.FieldValue.serverTimestamp():null});
                if(email!==ADMIN_EMAIL){await db.collection('solicitacoesAcesso').add({nome,email,dataHora:new Date().toLocaleString('pt-BR'),criadoEm:firebase.firestore.FieldValue.serverTimestamp()});}
                await auth.signOut();
                document.getElementById('cadastroAlert').innerHTML='<div class="alert alert-success"><strong>Conta criada!</strong><br>1. Verifique seu e-mail e clique no link de confirma√ß√£o<br>2. Aguarde aprova√ß√£o do administrador</div>';
            }catch(err){document.getElementById('cadastroAlert').innerHTML='<div class="alert alert-error">'+err.message+'</div>';}
        }
        function logout(){auth.signOut();}
        function togglePassword(id){const inp=document.getElementById(id);const icon=inp.parentElement.querySelector('i');if(inp.type==='password'){inp.type='text';icon.classList.remove('fa-eye');icon.classList.add('fa-eye-slash');}else{inp.type='password';icon.classList.remove('fa-eye-slash');icon.classList.add('fa-eye');}}
        function showPage(page){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));document.getElementById('page'+page.charAt(0).toUpperCase()+page.slice(1)).classList.add('active');const btn=document.getElementById('btn'+page.charAt(0).toUpperCase()+page.slice(1));if(btn)btn.classList.add('active');if(page==='acompanhamento')atualizarGraficosAcompanhamento();}
        function showLogin(){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('pageLogin').classList.add('active');}
        function showCadastro(){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('pageCadastro').classList.add('active');}
        function resetPassword(){alert('Em desenvolvimento');}
        // DADOS
        async function carregarPontos(){try{const snap=await db.collection('pontosAuditoria').orderBy('id').get();pontosAuditoria=snap.empty?DADOS_118_PONTOS:snap.docs.map(d=>({...d.data(),docId:d.id}));}catch(e){pontosAuditoria=DADOS_118_PONTOS;}pontosFiltrados=[...pontosAuditoria];}
        async function carregarCoordenadasFirestore(){
            try{
                const snap=await db.collection('coordenadasPDF').get();
                snap.docs.forEach(doc=>{
                    const data=doc.data();
                    const relCoords=PONTOS_COORDS[data.relatorio];
                    if(relCoords){
                        const ponto=relCoords.find(p=>p.id===data.id);
                        if(ponto&&data.coords){
                            ponto.coords=data.coords;
                        }
                    }
                });
                console.log('Coordenadas carregadas do Firestore:',snap.size);
            }catch(e){console.log('Usando coordenadas padr√£o');}
        }
        async function carregarDados118(){if(!confirm('Substituir dados?'))return;const snap=await db.collection('pontosAuditoria').get();for(const d of snap.docs)await d.ref.delete();for(const p of DADOS_118_PONTOS)await db.collection('pontosAuditoria').add(p);alert('118 pontos carregados!');location.reload();}
        function exportarDados(){const blob=new Blob([JSON.stringify(pontosAuditoria,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='backup.json';a.click();}
        async function limparDados(){if(!confirm('APAGAR tudo?'))return;const snap=await db.collection('pontosAuditoria').get();for(const d of snap.docs)await d.ref.delete();alert('Dados removidos!');location.reload();}
        // FILTROS
        function preencherFiltros(){const resp=[...new Set(pontosAuditoria.map(p=>p.responsavel))].sort();document.getElementById('filterResponsavel').innerHTML='<option value="">Todos</option>'+resp.map(r=>'<option value="'+r+'">'+r+'</option>').join('');}
        function aplicarFiltros(){const cat=document.getElementById('filterCategoria').value,hot=document.getElementById('filterHotel').value,crit=document.getElementById('filterCriticidade').value,stat=document.getElementById('filterStatus').value,resp=document.getElementById('filterResponsavel').value,busca=document.getElementById('filterBusca').value.toLowerCase();pontosFiltrados=pontosAuditoria.filter(p=>{if(cat&&p.categoria!==cat)return false;if(hot&&p.hotel!==hot)return false;if(crit&&p.criticidade!==crit)return false;if(stat&&p.status!==stat)return false;if(resp&&p.responsavel!==resp)return false;if(busca&&!(p.id+' '+p.ponto+' '+p.subcategoria).toLowerCase().includes(busca))return false;return true;});atualizarEstatisticas();renderizarTabela();}
        function limparFiltros(){['filterCategoria','filterHotel','filterCriticidade','filterStatus','filterResponsavel','filterBusca'].forEach(id=>document.getElementById(id).value='');pontosFiltrados=[...pontosAuditoria];atualizarEstatisticas();renderizarTabela();}
        function filterByCard(tipo){limparFiltros();if(tipo!=='total'){document.getElementById('filterCriticidade').value=tipo;aplicarFiltros();}}
        function atualizarEstatisticas(){const t=pontosAuditoria.length,a=pontosAuditoria.filter(p=>p.criticidade==='ALTA').length,m=pontosAuditoria.filter(p=>p.criticidade==='M√âDIA').length,b=pontosAuditoria.filter(p=>p.criticidade==='BAIXA').length;const af=pontosFiltrados.filter(p=>p.criticidade==='ALTA').length,mf=pontosFiltrados.filter(p=>p.criticidade==='M√âDIA').length,bf=pontosFiltrados.filter(p=>p.criticidade==='BAIXA').length;document.getElementById('totalPontos').textContent=t;document.getElementById('totalAlta').textContent=a;document.getElementById('totalMedia').textContent=m;document.getElementById('totalBaixa').textContent=b;const temFiltro=pontosFiltrados.length<t;document.getElementById('totalFiltrado').textContent=temFiltro?'('+pontosFiltrados.length+')':'';document.getElementById('altaFiltrado').textContent=temFiltro?'('+af+')':'';document.getElementById('mediaFiltrado').textContent=temFiltro?'('+mf+')':'';document.getElementById('baixaFiltrado').textContent=temFiltro?'('+bf+')':'';document.getElementById('countFiltrado').textContent=pontosFiltrados.length;}
        function renderizarTabela(){document.getElementById('tabelaPontos').innerHTML=pontosFiltrados.map(p=>'<tr><td><strong>'+p.id+'</strong></td><td>'+p.categoria+'</td><td>'+p.subcategoria+'</td><td>'+p.hotel+'</td><td><span class="badge badge-'+p.criticidade.toLowerCase().replace('√©','e')+'">'+p.criticidade+'</span></td><td><span class="badge badge-'+p.status.toLowerCase().replace(/ /g,'')+'">'+p.status+'</span></td><td>'+p.responsavel+'</td><td><button class="btn-detalhes" onclick="abrirDetalhes(\''+p.id+'\')"><i class="fas fa-eye"></i></button>'+(p.relatorios&&p.relatorios.length?'<button class="btn-pdf" onclick="abrirPdfDoPonto(\''+p.id+'\')"><i class="fas fa-file-pdf"></i></button>':'')+'</td></tr>').join('');}
        // MODAL
        function abrirDetalhes(id){const p=pontosAuditoria.find(x=>x.id===id);if(!p)return;document.getElementById('modalTitulo').textContent=p.id+' - '+p.subcategoria;let rel='';if(p.relatorios&&p.relatorios.length)rel='<div class="relatorios-links"><h4>Relat√≥rios</h4>'+p.relatorios.map(r=>RELATORIOS[r]?'<span class="relatorio-link" onclick="abrirPdfViewerNew(\''+r+'\',\''+id+'\');fecharModal();"><i class="fas fa-file-pdf"></i> '+RELATORIOS[r].nome+'</span>':'').join('')+'</div>';document.getElementById('modalBody').innerHTML='<div class="detail-grid"><div class="detail-item"><label>ID</label><p>'+p.id+'</p></div><div class="detail-item"><label>Categoria</label><p>'+p.categoria+'</p></div><div class="detail-item"><label>Hotel</label><p>'+p.hotel+'</p></div><div class="detail-item"><label>Criticidade</label><p>'+p.criticidade+'</p></div><div class="detail-item"><label>Status</label><p>'+p.status+'</p></div><div class="detail-item"><label>Respons√°vel</label><p>'+p.responsavel+'</p></div><div class="detail-item full-width"><label>Ponto</label><p>'+p.ponto+'</p></div><div class="detail-item full-width"><label>Recomenda√ß√£o</label><p>'+p.recomendacao+'</p></div></div>'+rel;document.getElementById('modalDetalhes').classList.add('active');}
        function fecharModal(){document.getElementById('modalDetalhes').classList.remove('active');}
        // RELAT√ìRIOS
        let ultimaBuscaRelatorios='';
        let pontoDestacado='';
        function carregarRelatoriosGrid(filtro=''){
            const busca=filtro.toLowerCase();
            ultimaBuscaRelatorios=filtro;
            let totalEncontrados=0;
            document.getElementById('relatoriosGrid').innerHTML=Object.values(RELATORIOS).map(rel=>{
                const v=pontosAuditoria.filter(p=>p.relatorios&&p.relatorios.includes(rel.id));
                const pontosMatch=busca?v.filter(p=>(p.id+' '+p.ponto+' '+p.subcategoria+' '+p.recomendacao+' '+p.responsavel).toLowerCase().includes(busca)):v;
                if(busca&&pontosMatch.length===0)return '';
                totalEncontrados+=pontosMatch.length;
                return'<div class="relatorio-card"><div class="relatorio-card-header"><h4>'+rel.nome+'</h4><span class="categoria">'+rel.categoria+'</span></div><div class="relatorio-card-body"><div class="relatorio-info"><span>'+rel.hotel+'</span><span>'+rel.paginas+' p√°g.</span></div><div class="relatorio-pontos"><h5>Pontos ('+(busca?pontosMatch.length+'/'+v.length:v.length)+')</h5><div class="pontos-badges">'+pontosMatch.map(p=>'<span class="ponto-badge'+(busca?' style="background:var(--dourado);color:var(--azul-marinho);"':'')+'" onclick="abrirPdfComPonto(\''+rel.id+'\',\''+p.id+'\',\''+filtro+'\')">'+p.id+'</span>').join('')+'</div></div><button class="btn-abrir-pdf" onclick="abrirPdfViewerNew(\''+rel.id+'\',\''+filtro+'\')"><i class="fas fa-eye"></i> Ver</button></div></div>';
            }).join('');
            document.getElementById('resultadoBuscaRel').textContent=busca?(totalEncontrados+' ponto(s) encontrado(s)'):'';
        }
        function abrirPdfComPonto(relId,pontoId,busca=''){
            pontoDestacado=pontoId;
            abrirPdfViewerNew(relId);
        }
        function filtrarRelatorios(){const busca=document.getElementById('filterRelatorios').value;carregarRelatoriosGrid(busca);}
        function limparFiltroRelatorios(){document.getElementById('filterRelatorios').value='';carregarRelatoriosGrid('');}
        function irParaPonto(id){showPage('dashboard');limparFiltros();document.getElementById('filterBusca').value=id;aplicarFiltros();}
        // PDF
        function abrirPdfViewer(relId,busca=''){const rel=RELATORIOS[relId];if(!rel)return;document.getElementById('pdfTitulo').textContent=rel.id+' - '+rel.nome;const buscaRef=document.getElementById('pdfBuscaRef');if(busca||pontoDestacado){let refText='';if(pontoDestacado)refText+=pontoDestacado;if(busca)refText+=(pontoDestacado?' | ':'')+'Busca: '+busca;buscaRef.innerHTML='<i class="fas fa-search"></i> '+refText;buscaRef.style.display='inline-block';}else{buscaRef.style.display='none';}document.getElementById('pdfEmbed').src='https://drive.google.com/file/d/'+rel.arquivo+'/preview';const v=pontosAuditoria.filter(p=>p.relatorios&&p.relatorios.includes(relId));document.getElementById('pdfPontosVinculados').innerHTML=v.map(p=>'<div class="pdf-ponto-link'+(p.id===pontoDestacado?' ponto-destacado':'')+'" onclick="fecharPdfViewer();irParaPonto(\''+p.id+'\')"><strong>'+p.id+'</strong><small>'+p.subcategoria+'</small></div>').join('');document.getElementById('pdfViewer').classList.add('active');pontoDestacado='';}
        function abrirPdfDoPonto(id){const p=pontosAuditoria.find(x=>x.id===id);if(p&&p.relatorios&&p.relatorios.length)abrirPdfViewerNew(p.relatorios[0],id);}
        function fecharPdfViewer(){document.getElementById('pdfViewer').classList.remove('active');document.getElementById('pdfEmbed').src='';}
        // NOVO VISUALIZADOR PDF COM COORDENADAS
        async function abrirPdfViewerNew(relId,pontoId=null){
            const rel=RELATORIOS[relId];if(!rel)return;
            pdfCurrentRel=relId;pdfCurrentPonto=pontoId;
            document.getElementById('pdfViewerTitulo').textContent=rel.nome;
            document.getElementById('pdfStatus').textContent='Carregando PDF...';
            document.getElementById('pdfViewerModal').classList.add('active');
            const pontos=PONTOS_COORDS[relId]||[];
            document.getElementById('pdfPontosListNew').innerHTML=pontos.map(p=>{
                const pa=pontosAuditoria.find(x=>x.id===p.id);
                return '<div class="pdf-ponto-item'+(p.id===pontoId?' active':'')+'" onclick="navegarParaPonto(\''+p.id+'\')" data-ponto="'+p.id+'"><div class="ponto-id">'+p.id+'</div><div class="ponto-desc">'+(pa?pa.ponto:'')+'</div><div class="ponto-page">üìÑ P√°gina '+p.pag+'</div></div>';
            }).join('');
            try{
                const url='https://pub-b543d163623a487ab225cf65b2703bf6.r2.dev/pdfs_renomeados/'+rel.arquivo;
                pdfDoc=await pdfjsLib.getDocument(url).promise;
                document.getElementById('pdfPageCount').textContent=pdfDoc.numPages;
                document.getElementById('pdfStatus').textContent=rel.nome;
                await renderAllPages();
                if(pontoId)navegarParaPonto(pontoId);
            }catch(e){document.getElementById('pdfStatus').textContent='Erro: '+e.message;}
        }
        async function renderAllPages(){
            const container=document.getElementById('pdfViewerPages');container.innerHTML='';
            for(let i=1;i<=pdfDoc.numPages;i++){
                const page=await pdfDoc.getPage(i);
                const viewport=page.getViewport({scale:pdfScale});
                const wrapper=document.createElement('div');wrapper.className='page-wrapper';wrapper.id='page-wrapper-'+i;wrapper.dataset.page=i;
                const canvas=document.createElement('canvas');canvas.className='pdf-page';canvas.id='pdf-page-'+i;
                canvas.width=viewport.width;canvas.height=viewport.height;
                canvas.onclick=function(e){identificarPontoNoClique(e,i);};
                wrapper.appendChild(canvas);
                const label=document.createElement('div');label.className='page-label';label.textContent='P√°gina '+i+' de '+pdfDoc.numPages;
                wrapper.appendChild(label);container.appendChild(wrapper);
                await page.render({canvasContext:canvas.getContext('2d'),viewport}).promise;
            }
            renderHighlights();
        }
        function renderHighlights(){
            document.querySelectorAll('.highlight-box').forEach(h=>h.remove());
            if(!pdfCurrentPonto)return;
            const pontos=PONTOS_COORDS[pdfCurrentRel]||[];
            const p=pontos.find(pt=>pt.id===pdfCurrentPonto);
            if(!p)return;
            const wrapper=document.getElementById('page-wrapper-'+p.pag);if(!wrapper)return;
            const canvas=document.getElementById('pdf-page-'+p.pag);if(!canvas)return;
            const c=p.coords,scaleX=canvas.width/595.28,scaleY=canvas.height/841.89;
            
            const box=document.createElement('div');box.className='highlight-box';box.id='highlight-'+p.id;
            box.style.left=(c.x*scaleX)+'px';box.style.top=(c.y*scaleY)+'px';
            box.style.width=(c.w*scaleX)+'px';box.style.height=Math.max(c.h*scaleY,25)+'px';
            box.style.background='rgba(201,162,39,0.6)';
            wrapper.appendChild(box);
        }
        function navegarParaPonto(pontoId){
            pdfCurrentPonto=pontoId;
            document.querySelectorAll('.pdf-ponto-item').forEach(el=>{el.classList.remove('active');if(el.dataset.ponto===pontoId)el.classList.add('active');});
            const pontos=PONTOS_COORDS[pdfCurrentRel]||[];
            const ponto=pontos.find(p=>p.id===pontoId);if(!ponto)return;
            renderHighlights();
            const wrapper=document.getElementById('page-wrapper-'+ponto.pag);
            if(wrapper){wrapper.scrollIntoView({behavior:'smooth',block:'center'});document.getElementById('pdfPageNum').textContent=ponto.pag;}
        }
        function fecharPdfViewerNew(){document.getElementById('pdfViewerModal').classList.remove('active');pdfDoc=null;pdfCurrentPonto=null;pdfCurrentRel=null;editMode=false;}
        let editMode=false,originalCoords=null,dragData=null;
        function toggleEditMode(){
            if(!pdfCurrentPonto){alert('Selecione um ponto primeiro');return;}
            editMode=!editMode;
            const box=document.querySelector('.highlight-box');
            const btnEdit=document.getElementById('btnEditMode');
            const btnSave=document.getElementById('btnSaveCoords');
            const btnCancel=document.getElementById('btnCancelEdit');
            const coordsDisp=document.getElementById('coordsDisplay');
            if(editMode){
                if(box){
                    box.classList.add('editable');
                    originalCoords={left:box.style.left,top:box.style.top,width:box.style.width,height:box.style.height};
                    makeDraggable(box);
                    makeResizable(box);
                }
                btnEdit.style.display='none';btnSave.style.display='inline-block';btnCancel.style.display='inline-block';coordsDisp.style.display='inline';
                updateCoordsDisplay();
            }else{
                if(box)box.classList.remove('editable');
                btnEdit.style.display='inline-block';btnSave.style.display='none';btnCancel.style.display='none';coordsDisp.style.display='none';
            }
        }
        function makeDraggable(el){
            el.onmousedown=function(e){
                if(e.target!==el)return;
                e.preventDefault();
                dragData={startX:e.clientX,startY:e.clientY,origLeft:parseInt(el.style.left),origTop:parseInt(el.style.top)};
                document.onmousemove=function(e){
                    el.style.left=(dragData.origLeft+e.clientX-dragData.startX)+'px';
                    el.style.top=(dragData.origTop+e.clientY-dragData.startY)+'px';
                    updateCoordsDisplay();
                };
                document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;};
            };
        }
        function makeResizable(el){
            const positions=['se','sw','ne','nw','n','s','e','w'];
            positions.forEach(pos=>{
                const handle=document.createElement('div');
                handle.className='resize-handle resize-'+pos;
                let css='position:absolute;background:var(--vermelho);';
                if(pos.includes('e'))css+='right:-5px;';
                if(pos.includes('w'))css+='left:-5px;';
                if(pos.includes('n'))css+='top:-5px;';
                if(pos.includes('s'))css+='bottom:-5px;';
                if(pos==='n'||pos==='s'){css+='left:50%;transform:translateX(-50%);width:20px;height:10px;cursor:ns-resize;';}
                else if(pos==='e'||pos==='w'){css+='top:50%;transform:translateY(-50%);width:10px;height:20px;cursor:ew-resize;';}
                else{css+='width:12px;height:12px;cursor:'+pos+'-resize;';}
                handle.style.cssText=css+'border-radius:2px;z-index:10;';
                el.appendChild(handle);
                handle.onmousedown=function(e){
                    e.preventDefault();e.stopPropagation();
                    const startW=parseInt(el.style.width),startH=parseInt(el.style.height);
                    const startL=parseInt(el.style.left),startT=parseInt(el.style.top);
                    const startX=e.clientX,startY=e.clientY;
                    document.onmousemove=function(ev){
                        const dx=ev.clientX-startX,dy=ev.clientY-startY;
                        if(pos.includes('e'))el.style.width=Math.max(20,startW+dx)+'px';
                        if(pos.includes('w')){el.style.width=Math.max(20,startW-dx)+'px';el.style.left=(startL+dx)+'px';}
                        if(pos.includes('s'))el.style.height=Math.max(20,startH+dy)+'px';
                        if(pos.includes('n')){el.style.height=Math.max(20,startH-dy)+'px';el.style.top=(startT+dy)+'px';}
                        updateCoordsDisplay();
                    };
                    document.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;};
                };
            });
        }
        function updateCoordsDisplay(){
            const box=document.querySelector('.highlight-box');if(!box)return;
            const canvas=document.getElementById('pdf-page-1');if(!canvas)return;
            const scaleX=canvas.width/595.28,scaleY=canvas.height/841.89;
            const x=Math.round(parseInt(box.style.left)/scaleX);
            const y=Math.round(parseInt(box.style.top)/scaleY);
            const w=Math.round(parseInt(box.style.width)/scaleX);
            const h=Math.round(parseInt(box.style.height)/scaleY);
            document.getElementById('coordsDisplay').textContent='x:'+x+' y:'+y+' w:'+w+' h:'+h;
        }
        async function salvarCoordenadas(){
            const box=document.querySelector('.highlight-box');if(!box)return;
            const pontos=PONTOS_COORDS[pdfCurrentRel]||[];
            const pontoAtual=pontos.find(p=>p.id===pdfCurrentPonto);if(!pontoAtual)return;
            const canvas=document.getElementById('pdf-page-'+pontoAtual.pag);if(!canvas)return;
            const scaleX=canvas.width/595.28,scaleY=canvas.height/841.89;
            const novasCoords={
                x:Math.round(parseInt(box.style.left)/scaleX*10)/10,
                y:Math.round(parseInt(box.style.top)/scaleY*10)/10,
                w:Math.round(parseInt(box.style.width)/scaleX*10)/10,
                h:Math.round(parseInt(box.style.height)/scaleY*10)/10
            };
            try{
                await db.collection('coordenadasPDF').doc(pdfCurrentPonto).set({
                    id:pdfCurrentPonto,
                    relatorio:pdfCurrentRel,
                    pagina:pontoAtual.pag,
                    coords:novasCoords,
                    atualizadoEm:firebase.firestore.FieldValue.serverTimestamp()
                });
                pontoAtual.coords=novasCoords;
                document.getElementById('pdfStatus').textContent='‚úÖ '+pdfCurrentPonto+' salvo!';
                document.getElementById('pdfStatus').style.background='var(--verde)';
                setTimeout(()=>{document.getElementById('pdfStatus').style.background='var(--dourado)';renderHighlights();},1500);
            }catch(e){
                alert('Erro ao salvar: '+e.message);
            }
            toggleEditMode();
        }
        function cancelarEdicao(){
            const box=document.querySelector('.highlight-box');
            if(box&&originalCoords){
                box.style.left=originalCoords.left;box.style.top=originalCoords.top;
                box.style.width=originalCoords.width;box.style.height=originalCoords.height;
            }
            toggleEditMode();
        }
        function identificarPontoNoClique(e,pagina){
            if(editMode)return;
            const canvas=e.target;
            const rect=canvas.getBoundingClientRect();
            const clickX=e.clientX-rect.left;
            const clickY=e.clientY-rect.top;
            const scaleX=canvas.width/595.28,scaleY=canvas.height/841.89;
            const pdfX=clickX/scaleX,pdfY=clickY/scaleY;
            const pontos=PONTOS_COORDS[pdfCurrentRel]||[];
            const pontoEncontrado=pontos.find(p=>{
                if(p.pag!==pagina)return false;
                const c=p.coords;
                return pdfX>=c.x && pdfX<=(c.x+c.w) && pdfY>=c.y && pdfY<=(c.y+c.h);
            });
            if(pontoEncontrado){
                navegarParaPonto(pontoEncontrado.id);
                const pa=pontosAuditoria.find(x=>x.id===pontoEncontrado.id);
                if(pa){
                    document.getElementById('pdfStatus').textContent=pa.id+' - '+pa.ponto;
                    document.getElementById('pdfStatus').style.background='var(--verde)';
                    setTimeout(()=>{document.getElementById('pdfStatus').style.background='var(--dourado)';},2000);
                }
            }else{
                document.getElementById('pdfStatus').textContent='Clique: x='+Math.round(pdfX)+' y='+Math.round(pdfY)+' (p√°g '+pagina+')';
                document.getElementById('pdfStatus').style.background='var(--azul-claro)';
                setTimeout(()=>{document.getElementById('pdfStatus').style.background='var(--dourado)';},2000);
            }
        }
        function pdfZoomIn(){pdfScale=Math.min(pdfScale+0.2,3);document.getElementById('pdfZoomLevel').textContent=Math.round(pdfScale*100)+'%';if(pdfDoc)renderAllPages();}
        function pdfZoomOut(){pdfScale=Math.max(pdfScale-0.2,0.5);document.getElementById('pdfZoomLevel').textContent=Math.round(pdfScale*100)+'%';if(pdfDoc)renderAllPages();}
        function pdfPrevPage(){const curr=parseInt(document.getElementById('pdfPageNum').textContent);if(curr>1){const w=document.getElementById('page-wrapper-'+(curr-1));if(w){w.scrollIntoView({behavior:'smooth'});document.getElementById('pdfPageNum').textContent=curr-1;}}}
        function pdfNextPage(){const curr=parseInt(document.getElementById('pdfPageNum').textContent);const total=parseInt(document.getElementById('pdfPageCount').textContent);if(curr<total){const w=document.getElementById('page-wrapper-'+(curr+1));if(w){w.scrollIntoView({behavior:'smooth'});document.getElementById('pdfPageNum').textContent=curr+1;}}}
        // GR√ÅFICOS
        let filtroAtivo={tipo:null,valor:null};
        function atualizarGraficosAcompanhamento(){
            const st=document.getElementById('filterStatusAcomp').value;
            let dados=st?pontosAuditoria.filter(p=>p.status===st):pontosAuditoria;
            
            // Aplicar filtro ativo se existir
            if(filtroAtivo.tipo&&filtroAtivo.valor){
                if(filtroAtivo.tipo==='categoria')dados=dados.filter(p=>p.categoria===filtroAtivo.valor);
                else if(filtroAtivo.tipo==='hotel')dados=dados.filter(p=>p.hotel===filtroAtivo.valor);
                else if(filtroAtivo.tipo==='criticidade')dados=dados.filter(p=>p.criticidade===filtroAtivo.valor);
            }
            
            document.getElementById('totalFiltradoAcomp').textContent=dados.length+' pontos'+(filtroAtivo.valor?' ('+filtroAtivo.valor+')':'')+(st?' - '+st:'');
            [chartCategoria,chartHotel,chartCriticidade,chartResponsavel,chartAtraso].forEach(c=>{if(c)c.destroy();});
            
            const capitalizar=(txt)=>txt.charAt(0).toUpperCase()+txt.slice(1).toLowerCase();
            const abreviar=(txt)=>{const map={'FRAUDE/IRREGULARIDADE':'Fraude','Brasil 21 Convention':'Convention','Brasil 21 Su√≠tes':'Su√≠tes','Meli√° Brasil 21':'Meli√°','Todos os Hot√©is':'Todos','CONT√ÅBIL':'Cont√°bil','OPERACIONAL':'Operacional','CONTROLES':'Controles'};return map[txt]||capitalizar(txt);};
            const criarOpcoes=(tipo,labels,valores)=>({plugins:{legend:{display:false},datalabels:{color:'#fff',font:{weight:'bold',size:9},formatter:(value,ctx)=>{const total=ctx.chart.data.datasets[0].data.reduce((a,b)=>a+b,0);const pct=total>0?Math.round(value/total*100):0;const label=abreviar(ctx.chart.data.labels[ctx.dataIndex]);return label+'\n('+value+')\n'+pct+'%';},textAlign:'center'}},onClick:(e,elements)=>{if(elements.length>0){const idx=elements[0].index;const valor=labels[idx];if(filtroAtivo.tipo===tipo&&filtroAtivo.valor===valor){filtroAtivo={tipo:null,valor:null};}else{filtroAtivo={tipo,valor};}atualizarGraficosAcompanhamento();}}});
            
            const cat={};dados.forEach(p=>cat[p.categoria]=(cat[p.categoria]||0)+1);
            const catLabels=Object.keys(cat),catValues=Object.values(cat);
            const catColors=catLabels.map(l=>filtroAtivo.tipo==='categoria'&&filtroAtivo.valor!==l?'rgba(150,150,150,0.3)':{'CONT√ÅBIL':'#1A2E4C','OPERACIONAL':'#C9A227','CONTROLES':'#DC3545','FRAUDE/IRREGULARIDADE':'#28A745'}[l]||'#666');
            chartCategoria=new Chart(document.getElementById('chartCategoria'),{type:'doughnut',data:{labels:catLabels,datasets:[{data:catValues,backgroundColor:catColors}]},options:criarOpcoes('categoria',catLabels,catValues),plugins:[ChartDataLabels]});
            
            const hot={};dados.forEach(p=>hot[p.hotel]=(hot[p.hotel]||0)+1);
            const hotLabels=Object.keys(hot),hotValues=Object.values(hot);
            const hotColors=hotLabels.map((l,i)=>filtroAtivo.tipo==='hotel'&&filtroAtivo.valor!==l?'rgba(150,150,150,0.3)':['#0d6efd','#20c997','#fd7e14','#6610f2'][i%4]);
            chartHotel=new Chart(document.getElementById('chartHotel'),{type:'doughnut',data:{labels:hotLabels,datasets:[{data:hotValues,backgroundColor:hotColors}]},options:criarOpcoes('hotel',hotLabels,hotValues),plugins:[ChartDataLabels]});
            
            const crit={ALTA:0,M√âDIA:0,BAIXA:0};dados.forEach(p=>crit[p.criticidade]++);
            const critLabels=['ALTA','M√âDIA','BAIXA'],critValues=[crit.ALTA,crit.M√âDIA,crit.BAIXA];
            const critColors=critLabels.map(l=>filtroAtivo.tipo==='criticidade'&&filtroAtivo.valor!==l?'rgba(150,150,150,0.3)':{'ALTA':'#DC3545','M√âDIA':'#FFA500','BAIXA':'#28A745'}[l]);
            chartCriticidade=new Chart(document.getElementById('chartCriticidade'),{type:'doughnut',data:{labels:critLabels,datasets:[{data:critValues,backgroundColor:critColors}]},options:{plugins:{legend:{display:false},datalabels:{color:'#fff',font:{weight:'bold',size:11},formatter:(value,ctx)=>{const total=ctx.chart.data.datasets[0].data.reduce((a,b)=>a+b,0);const pct=total>0?Math.round(value/total*100):0;const map={'ALTA':'Alta','M√âDIA':'M√©dia','BAIXA':'Baixa'};return map[ctx.chart.data.labels[ctx.dataIndex]]+'\n('+value+')\n'+pct+'%';},textAlign:'center'}},onClick:(e,elements)=>{if(elements.length>0){const idx=elements[0].index;const valor=critLabels[idx];if(filtroAtivo.tipo==='criticidade'&&filtroAtivo.valor===valor){filtroAtivo={tipo:null,valor:null};}else{filtroAtivo={tipo:'criticidade',valor};}atualizarGraficosAcompanhamento();}}},plugins:[ChartDataLabels]});
            
            const resp={};dados.forEach(p=>resp[p.responsavel]=(resp[p.responsavel]||0)+1);const rLabels=Object.keys(resp).sort((a,b)=>resp[b]-resp[a]);
            chartResponsavel=new Chart(document.getElementById('chartResponsavel'),{type:'bar',data:{labels:rLabels,datasets:[{data:rLabels.map(r=>resp[r]),backgroundColor:rLabels.map((_,i)=>'hsl('+(i*15)+',65%,50%)')}]},options:{indexAxis:'y',plugins:{legend:{display:false},tooltip:{enabled:false},datalabels:{anchor:'center',align:'center',color:'#fff',font:{weight:'bold',size:11}}},scales:{x:{grid:{display:false}},y:{grid:{display:false},ticks:{font:{size:11}}}},maintainAspectRatio:false,barThickness:18},plugins:[ChartDataLabels]});
            
            const hoje=new Date(),faixas={'0-5 dias':0,'6-15 dias':0,'16-30 dias':0,'Acima de 30':0};
            dados.filter(p=>p.status!=='Conclu√≠do').forEach(p=>{const dias=Math.floor((hoje-DATA_BASE)/(1000*60*60*24));if(dias<=5)faixas['0-5 dias']++;else if(dias<=15)faixas['6-15 dias']++;else if(dias<=30)faixas['16-30 dias']++;else faixas['Acima de 30']++;});
            chartAtraso=new Chart(document.getElementById('chartAtraso'),{type:'bar',data:{labels:Object.keys(faixas),datasets:[{data:Object.values(faixas),backgroundColor:['#28A745','#FFA500','#fd7e14','#DC3545']}]},options:{plugins:{legend:{display:false},datalabels:{anchor:'end',align:'top',color:'#333',font:{weight:'bold'}}},maintainAspectRatio:false},plugins:[ChartDataLabels]});
        }
        // USU√ÅRIOS
        function formatarData(ts){if(!ts)return'-';const d=ts.toDate?ts.toDate():new Date(ts);return d.toLocaleDateString('pt-BR')+' '+d.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});}
        async function carregarUsuarios(){
            try{
                const snap=await db.collection('usuarios').get();
                const pendentes=[],aprovados=[];
                snap.docs.forEach(doc=>{const u={id:doc.id,...doc.data()};if(u.aprovado)aprovados.push(u);else pendentes.push(u);});
                document.getElementById('usuariosPendentes').innerHTML=pendentes.length===0?'<p style="color:#666;">Nenhum usu√°rio pendente.</p>':pendentes.map(u=>'<div class="usuario-card"><div class="usuario-card-header"><div class="usuario-info"><strong>'+(u.nome||'Sem nome')+'</strong><small>'+u.email+'</small>'+(u.emailVerificado?'<span class="badge badge-concluido" style="margin-left:8px;"><i class="fas fa-check"></i> E-mail verificado</span>':'<span class="badge badge-pendente" style="margin-left:8px;"><i class="fas fa-clock"></i> Aguardando verifica√ß√£o</span>')+'</div>'+(u.emailVerificado?'<button class="btn-aprovar" onclick="aprovarUsuario(\''+u.id+'\')"><i class="fas fa-check"></i> Aprovar</button>':'<span style="color:#999;font-size:0.8rem;">Aguarde verificar e-mail</span>')+'</div><div class="usuario-datas"><div><i class="fas fa-clock"></i> Solicitado: '+formatarData(u.solicitadoEm)+'</div></div></div>').join('');
                document.getElementById('usuariosAprovados').innerHTML=aprovados.length===0?'<p style="color:#666;">Nenhum usu√°rio aprovado.</p>':aprovados.map(u=>'<div class="usuario-card"><div class="usuario-card-header"><div class="usuario-info"><strong>'+(u.nome||'Sem nome')+'</strong><small>'+u.email+'</small>'+(u.role==='admin'?'<span class="badge badge-alta" style="margin-left:10px;">Admin</span>':'')+'</div>'+(u.email!==ADMIN_EMAIL?'<button class="btn-revogar" onclick="revogarUsuario(\''+u.id+'\')"><i class="fas fa-times"></i> Revogar</button>':'')+'</div><div class="usuario-datas"><div><i class="fas fa-clock"></i> Solicitado: '+formatarData(u.solicitadoEm)+'</div><div><i class="fas fa-check-circle"></i> Aprovado: '+formatarData(u.aprovadoEm)+'</div></div></div>').join('');
            }catch(e){console.error('Erro:',e);document.getElementById('usuariosPendentes').innerHTML='<p style="color:#666;">Erro ao carregar</p>';document.getElementById('usuariosAprovados').innerHTML='<p style="color:#666;">Erro ao carregar</p>';}
        }
        async function aprovarUsuario(uid){if(!confirm('Aprovar este usu√°rio?'))return;try{await db.collection('usuarios').doc(uid).update({aprovado:true,aprovadoEm:firebase.firestore.FieldValue.serverTimestamp()});carregarUsuarios();}catch(e){alert('Erro: '+e.message);}}
        async function revogarUsuario(uid){if(!confirm('Revogar acesso?'))return;try{await db.collection('usuarios').doc(uid).update({aprovado:false,aprovadoEm:null});carregarUsuarios();}catch(e){alert('Erro: '+e.message);}}
        // EVENTOS
        document.addEventListener('keydown',e=>{if(e.key==='Escape'){fecharModal();fecharPdfViewer();fecharPdfViewerNew();fecharModalDocumento();}});
        document.getElementById('modalDetalhes').addEventListener('click',e=>{if(e.target.id==='modalDetalhes')fecharModal();});
        
        // PWA - Instala√ß√£o do App
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('btnInstallApp').style.display = 'flex';
        });
        
        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    document.getElementById('btnInstallApp').style.display = 'none';
                }
                deferredPrompt = null;
            }
        }
        
        window.addEventListener('appinstalled', () => {
            document.getElementById('btnInstallApp').style.display = 'none';
            console.log('App instalado com sucesso!');
        });
        
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(() => {
                console.log('Service Worker registrado');
            }).catch(err => console.log('SW erro:', err));
        }
        
        // GERENCIAMENTO DE DOCUMENTOS
        let documentosAdicionais={};
        async function carregarDocumentosAdicionais(){
            try{
                const snap=await db.collection('documentosAuditoria').orderBy('criadoEm','desc').get();
                snap.docs.forEach(doc=>{
                    const d=doc.data();
                    documentosAdicionais[d.id]={...d,docId:doc.id};
                });
                console.log('Documentos carregados:',Object.keys(documentosAdicionais).length);
            }catch(e){console.log('Erro ao carregar documentos:',e);}
        }
        carregarDocumentosAdicionais();
        
        function abrirModalNovoDocumento(){
            const categoriasDocs=['E-MAIL ENVIADO','E-MAIL RECEBIDO','COMPROVANTE','DOCUMENTO','PLANILHA','RELAT√ìRIO','OUTROS'];
            const pontosOpts=pontosAuditoria.map(p=>'<option value="'+p.id+'">'+p.id+' - '+p.ponto.substring(0,50)+'</option>').join('');
            const hoteis=[...new Set(pontosAuditoria.map(p=>p.hotel))].sort();
            const categoriasPA=[...new Set(pontosAuditoria.map(p=>p.categoria))].sort();
            const responsaveis=[...new Set(pontosAuditoria.map(p=>p.responsavel))].sort();
            const criticidades=['ALTA','M√âDIA','BAIXA'];
            const proximoPA=Math.max(...pontosAuditoria.map(p=>parseInt(p.id.replace('PA-',''))||0))+1;
            
            document.getElementById('modalDocumentoBody').innerHTML=`
                <div style="max-height:70vh;overflow-y:auto;padding-right:10px;">
                <h4 style="color:var(--azul-marinho);border-bottom:2px solid var(--dourado);padding-bottom:8px;margin-bottom:15px;"><i class="fas fa-file-alt"></i> Dados do Documento</h4>
                <div class="form-group"><label>T√≠tulo do Documento *</label><input type="text" id="docTitulo" placeholder="Ex: E-mail para Controladoria sobre irregularidade"></div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                    <div class="form-group"><label>Categoria *</label><select id="docCategoria">${categoriasDocs.map(c=>'<option value="'+c+'">'+c+'</option>').join('')}</select></div>
                    <div class="form-group"><label>Data do Documento</label><input type="date" id="docData" value="${new Date().toISOString().split('T')[0]}"></div>
                </div>
                <div class="form-group"><label>Descri√ß√£o</label><textarea id="docDescricao" rows="2" placeholder="Detalhes sobre o documento..."></textarea></div>
                <div class="form-group"><label>URL do Arquivo (Google Drive, Cloudflare, etc.)</label><input type="text" id="docURL" placeholder="https://..."></div>
                <div class="form-group"><label>Ou cole o conte√∫do do e-mail</label><textarea id="docConteudo" rows="3" placeholder="Cole aqui o texto do e-mail ou documento..."></textarea></div>
                
                <h4 style="color:var(--azul-marinho);border-bottom:2px solid var(--dourado);padding-bottom:8px;margin:20px 0 15px 0;"><i class="fas fa-link"></i> Vincula√ß√£o com Pontos de Auditoria</h4>
                <div style="background:#f8f9fa;padding:15px;border-radius:10px;margin-bottom:15px;">
                    <div style="display:flex;gap:20px;flex-wrap:wrap;">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;"><input type="checkbox" id="chkVincularExistente" onchange="toggleSecaoVinculo()"> <i class="fas fa-link" style="color:var(--azul-claro);"></i> Vincular a PA(s) existente(s)</label>
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;"><input type="checkbox" id="chkCriarNovo" onchange="toggleSecaoVinculo()"> <i class="fas fa-plus-circle" style="color:var(--verde);"></i> Criar novo(s) PA(s)</label>
                    </div>
                </div>
                
                <div id="secaoVincularExistente" style="display:none;background:#e8f4f8;padding:15px;border-radius:10px;margin-bottom:15px;border-left:4px solid var(--azul-claro);">
                    <h5 style="color:var(--azul-claro);margin-bottom:10px;"><i class="fas fa-list"></i> Selecione os PAs existentes</h5>
                    <select id="docPontos" multiple style="height:120px;width:100%;">${pontosOpts}</select>
                    <small style="color:#666;">Ctrl+Click para selecionar m√∫ltiplos</small>
                </div>
                
                <div id="secaoCriarNovo" style="display:none;background:#e8f8e8;padding:15px;border-radius:10px;border-left:4px solid var(--verde);">
                    <h5 style="color:var(--verde);margin-bottom:15px;"><i class="fas fa-plus-circle"></i> Criar Novo Ponto de Auditoria</h5>
                    <div id="listaNovosPA"></div>
                    <button type="button" class="btn-admin success" onclick="adicionarNovoPA()" style="margin-top:10px;"><i class="fas fa-plus"></i> Adicionar PA</button>
                </div>
                </div>
                
                <div class="admin-buttons" style="margin-top:20px;border-top:1px solid #ddd;padding-top:15px;">
                    <button class="btn-admin primary" onclick="salvarNovoDocumento()"><i class="fas fa-save"></i> Salvar Documento</button>
                    <button class="btn-admin danger" onclick="fecharModalDocumento()"><i class="fas fa-times"></i> Cancelar</button>
                </div>
            `;
            window.novosPA=[];
            window.opcoesPA={hoteis,categoriasPA,responsaveis,criticidades,proximoPA};
            document.getElementById('modalDocumento').classList.add('active');
        }
        
        function toggleSecaoVinculo(){
            document.getElementById('secaoVincularExistente').style.display=document.getElementById('chkVincularExistente').checked?'block':'none';
            document.getElementById('secaoCriarNovo').style.display=document.getElementById('chkCriarNovo').checked?'block':'none';
            if(document.getElementById('chkCriarNovo').checked&&window.novosPA.length===0)adicionarNovoPA();
        }
        
        function adicionarNovoPA(){
            const idx=window.novosPA.length;
            const numPA=window.opcoesPA.proximoPA+idx;
            const {hoteis,categoriasPA,responsaveis,criticidades}=window.opcoesPA;
            window.novosPA.push({});
            const container=document.getElementById('listaNovosPA');
            const div=document.createElement('div');
            div.id='novoPA_'+idx;
            div.style.cssText='background:#fff;padding:15px;border-radius:8px;margin-bottom:15px;border:1px solid #ddd;position:relative;';
            div.innerHTML=`
                <button type="button" onclick="removerNovoPA(${idx})" style="position:absolute;top:5px;right:5px;background:var(--vermelho);color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer;font-size:12px;">&times;</button>
                <h6 style="color:var(--dourado);margin-bottom:12px;"><i class="fas fa-flag"></i> Novo PA #${idx+1}</h6>
                <div style="display:grid;grid-template-columns:100px 1fr;gap:10px;margin-bottom:10px;">
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">ID *</label><input type="text" id="npa_id_${idx}" value="PA-${String(numPA).padStart(3,'0')}" style="font-weight:bold;"></div>
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Ponto/T√≠tulo *</label><input type="text" id="npa_ponto_${idx}" placeholder="Descri√ß√£o do ponto de auditoria"></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Hotel *</label>
                        <select id="npa_hotel_${idx}" onchange="checkOutro(this,'npa_hotel_outro_${idx}')">
                            ${hoteis.map(h=>'<option value="'+h+'">'+h+'</option>').join('')}
                            <option value="__outro__">+ Outro (cadastrar novo)</option>
                        </select>
                        <input type="text" id="npa_hotel_outro_${idx}" placeholder="Digite o novo hotel" style="display:none;margin-top:5px;">
                    </div>
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Categoria *</label>
                        <select id="npa_categoria_${idx}" onchange="checkOutro(this,'npa_categoria_outro_${idx}')">
                            ${categoriasPA.map(c=>'<option value="'+c+'">'+c+'</option>').join('')}
                            <option value="__outro__">+ Outro (cadastrar novo)</option>
                        </select>
                        <input type="text" id="npa_categoria_outro_${idx}" placeholder="Digite a nova categoria" style="display:none;margin-top:5px;">
                    </div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Subcategoria</label><input type="text" id="npa_subcategoria_${idx}" placeholder="Ex: 111.01.001 ou Contas Pendentes"></div>
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Criticidade *</label>
                        <select id="npa_criticidade_${idx}">
                            ${criticidades.map(c=>'<option value="'+c+'"'+(c==='ALTA'?' selected':'')+'>'+c+'</option>').join('')}
                        </select>
                    </div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px;">
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Respons√°vel *</label>
                        <select id="npa_responsavel_${idx}" onchange="checkOutro(this,'npa_responsavel_outro_${idx}')">
                            ${responsaveis.map(r=>'<option value="'+r+'">'+r+'</option>').join('')}
                            <option value="__outro__">+ Outro (cadastrar novo)</option>
                        </select>
                        <input type="text" id="npa_responsavel_outro_${idx}" placeholder="Digite o novo respons√°vel" style="display:none;margin-top:5px;">
                    </div>
                    <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Prazo</label>
                        <select id="npa_prazo_${idx}">
                            <option value="10 dias">10 dias</option>
                            <option value="15 dias">15 dias</option>
                            <option value="30 dias" selected>30 dias</option>
                            <option value="45 dias">45 dias</option>
                            <option value="60 dias">60 dias</option>
                            <option value="90 dias">90 dias</option>
                        </select>
                    </div>
                </div>
                <div class="form-group" style="margin:0;"><label style="font-size:0.75rem;">Recomenda√ß√£o</label><input type="text" id="npa_recomendacao_${idx}" placeholder="A√ß√£o recomendada..."></div>
            `;
            container.appendChild(div);
        }
        
        function removerNovoPA(idx){
            document.getElementById('novoPA_'+idx).remove();
            window.novosPA[idx]=null;
        }
        
        function checkOutro(select,outroId){
            const outro=document.getElementById(outroId);
            if(select.value==='__outro__'){outro.style.display='block';outro.focus();}
            else{outro.style.display='none';outro.value='';}
        }
        
        function getValorOuOutro(selectId,outroId){
            const select=document.getElementById(selectId);
            if(select.value==='__outro__')return document.getElementById(outroId).value.trim();
            return select.value;
        }
        
        async function salvarNovoDocumento(){
            const titulo=document.getElementById('docTitulo').value.trim();
            const categoria=document.getElementById('docCategoria').value;
            if(!titulo){alert('T√≠tulo √© obrigat√≥rio!');return;}
            
            const pontosRelacionados=[];
            const novosPACriados=[];
            
            if(document.getElementById('chkVincularExistente').checked){
                const pontosSelect=document.getElementById('docPontos');
                pontosRelacionados.push(...Array.from(pontosSelect.selectedOptions).map(o=>o.value));
            }
            
            if(document.getElementById('chkCriarNovo').checked){
                for(let i=0;i<window.novosPA.length;i++){
                    if(window.novosPA[i]===null)continue;
                    const id=document.getElementById('npa_id_'+i).value.trim();
                    const ponto=document.getElementById('npa_ponto_'+i).value.trim();
                    const hotel=getValorOuOutro('npa_hotel_'+i,'npa_hotel_outro_'+i);
                    const cat=getValorOuOutro('npa_categoria_'+i,'npa_categoria_outro_'+i);
                    const resp=getValorOuOutro('npa_responsavel_'+i,'npa_responsavel_outro_'+i);
                    
                    if(!id||!ponto||!hotel||!cat||!resp){alert('Preencha todos os campos obrigat√≥rios do PA #'+(i+1));return;}
                    if(pontosAuditoria.find(p=>p.id===id)){alert('O ID '+id+' j√° existe! Use outro ID.');return;}
                    
                    const novoPA={
                        id:id,ponto:ponto,hotel:hotel,categoria:cat,
                        subcategoria:document.getElementById('npa_subcategoria_'+i).value.trim()||'Geral',
                        criticidade:document.getElementById('npa_criticidade_'+i).value,
                        responsavel:resp,prazo:document.getElementById('npa_prazo_'+i).value,
                        recomendacao:document.getElementById('npa_recomendacao_'+i).value.trim()||'Verificar e regularizar',
                        status:'Pendente',pagina_ref:'1',relatorios:['DOC'],criadoEm:new Date().toISOString(),origem:'documento'
                    };
                    novosPACriados.push(novoPA);
                    pontosRelacionados.push(id);
                }
            }
            
            try{
                for(const pa of novosPACriados){await db.collection('pontosAuditoria').add(pa);pontosAuditoria.push(pa);}
                const novoDoc={
                    id:'DOC-'+Date.now(),titulo:titulo,categoria:categoria,
                    descricao:document.getElementById('docDescricao').value.trim(),
                    data:document.getElementById('docData').value,
                    pontosRelacionados:pontosRelacionados,
                    urlArquivo:document.getElementById('docURL').value.trim(),
                    conteudo:document.getElementById('docConteudo').value.trim(),
                    criadoEm:firebase.firestore.FieldValue.serverTimestamp(),
                    criadoPor:auth.currentUser?auth.currentUser.email:'admin',
                    novosPACriados:novosPACriados.map(p=>p.id)
                };
                await db.collection('documentosAuditoria').add(novoDoc);
                documentosAdicionais[novoDoc.id]=novoDoc;
                let msg='Documento salvo com sucesso!';
                if(novosPACriados.length>0)msg+='\n\n'+novosPACriados.length+' novo(s) PA(s) criado(s): '+novosPACriados.map(p=>p.id).join(', ');
                if(pontosRelacionados.length>0)msg+='\n\nVinculado a: '+pontosRelacionados.join(', ');
                alert(msg);
                fecharModalDocumento();listarDocumentos();
                pontosFiltrados=[...pontosAuditoria];atualizarEstatisticas();renderizarTabela();
            }catch(e){alert('Erro ao salvar: '+e.message);}
        }
        
        function fecharModalDocumento(){
            document.getElementById('modalDocumento').classList.remove('active');
        }
        
        async function listarDocumentos(){
            const container=document.getElementById('listaDocumentosAdmin');
            container.innerHTML='<p style="color:#666;">Carregando...</p>';
            try{
                const snap=await db.collection('documentosAuditoria').orderBy('criadoEm','desc').get();
                if(snap.empty){container.innerHTML='<p style="color:#666;">Nenhum documento adicionado ainda.</p>';return;}
                let html='<div style="max-height:400px;overflow-y:auto;">';
                snap.docs.forEach(doc=>{
                    const d=doc.data();
                    const pontos=d.pontosRelacionados&&d.pontosRelacionados.length?d.pontosRelacionados.join(', '):'Nenhum';
                    html+=`<div style="background:#f8f9fa;padding:12px;border-radius:8px;margin-bottom:10px;border-left:4px solid var(--dourado);">
                        <div style="display:flex;justify-content:space-between;align-items:start;">
                            <div>
                                <strong style="color:var(--azul-marinho);">${d.titulo}</strong>
                                <span style="background:var(--azul-claro);color:white;padding:2px 8px;border-radius:10px;font-size:0.7rem;margin-left:8px;">${d.categoria}</span>
                            </div>
                            <div style="display:flex;gap:5px;">
                                <button onclick="verDocumento('${doc.id}')" style="background:var(--dourado);border:none;padding:5px 10px;border-radius:5px;cursor:pointer;" title="Ver"><i class="fas fa-eye"></i></button>
                                <button onclick="editarDocumento('${doc.id}')" style="background:var(--azul-claro);color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;" title="Editar"><i class="fas fa-edit"></i></button>
                                <button onclick="duplicarDocumento('${doc.id}')" style="background:var(--verde);color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;" title="Duplicar"><i class="fas fa-copy"></i></button>
                                <button onclick="downloadDocumentoWord('${doc.id}')" style="background:#2b579a;color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;" title="Download Word"><i class="fas fa-file-word"></i></button>
                                <button onclick="excluirDocumento('${doc.id}')" style="background:var(--vermelho);color:white;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;" title="Excluir"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div style="font-size:0.8rem;color:#666;margin-top:5px;">
                            <span><i class="fas fa-calendar"></i> ${d.data||'N/A'}</span>
                            <span style="margin-left:15px;"><i class="fas fa-link"></i> ${pontos}</span>
                        </div>
                    </div>`;
                });
                html+='</div>';
                container.innerHTML=html;
            }catch(e){container.innerHTML='<p style="color:var(--vermelho);">Erro: '+e.message+'</p>';}
        }
        
        async function verDocumento(docId){
            try{
                const doc=await db.collection('documentosAuditoria').doc(docId).get();
                if(!doc.exists){alert('Documento n√£o encontrado');return;}
                const d=doc.data();
                let conteudoHTML='';
                if(d.urlArquivo){
                    conteudoHTML+=`<p><strong>Arquivo:</strong> <a href="${d.urlArquivo}" target="_blank" style="color:var(--dourado);">${d.urlArquivo}</a></p>`;
                }
                if(d.conteudo){
                    conteudoHTML+=`<div style="background:#f5f5f5;padding:15px;border-radius:8px;margin-top:10px;white-space:pre-wrap;font-family:monospace;font-size:0.85rem;max-height:300px;overflow-y:auto;">${d.conteudo}</div>`;
                }
                document.getElementById('modalDocumentoBody').innerHTML=`
                    <h4 style="color:var(--azul-marinho);margin-bottom:10px;">${d.titulo}</h4>
                    <p><span style="background:var(--azul-claro);color:white;padding:3px 10px;border-radius:10px;font-size:0.8rem;">${d.categoria}</span></p>
                    <p style="margin-top:10px;"><strong>Data:</strong> ${d.data||'N/A'}</p>
                    <p><strong>Pontos Relacionados:</strong> ${d.pontosRelacionados&&d.pontosRelacionados.length?d.pontosRelacionados.join(', '):'Nenhum'}</p>
                    ${d.descricao?'<p><strong>Descri√ß√£o:</strong> '+d.descricao+'</p>':''}
                    ${conteudoHTML}
                    <div style="margin-top:20px;text-align:center;">
                        <button class="btn-admin primary" onclick="fecharModalDocumento()"><i class="fas fa-times"></i> Fechar</button>
                    </div>
                `;
                document.getElementById('modalDocumento').classList.add('active');
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function excluirDocumento(docId){
            if(!confirm('Tem certeza que deseja excluir este documento?'))return;
            try{
                await db.collection('documentosAuditoria').doc(docId).delete();
                alert('Documento exclu√≠do!');
                listarDocumentos();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function duplicarDocumento(docId){
            try{
                const doc=await db.collection('documentosAuditoria').doc(docId).get();
                if(!doc.exists){alert('Documento n√£o encontrado');return;}
                const d=doc.data();
                const snap=await db.collection('documentosAuditoria').get();
                let contador=1;
                const tituloBase=d.titulo.replace(/\s*\(\d+\)$/,'');
                snap.docs.forEach(dc=>{
                    const t=dc.data().titulo;
                    if(t.startsWith(tituloBase)){
                        const match=t.match(/\((\d+)\)$/);
                        if(match)contador=Math.max(contador,parseInt(match[1])+1);
                        else if(t===tituloBase)contador=Math.max(contador,1);
                    }
                });
                const novaCopia={...d,titulo:tituloBase+' ('+contador+')',id:'DOC-'+Date.now(),criadoEm:firebase.firestore.FieldValue.serverTimestamp(),criadoPor:auth.currentUser?auth.currentUser.email:'admin'};
                await db.collection('documentosAuditoria').add(novaCopia);
                alert('Documento duplicado: '+novaCopia.titulo);
                listarDocumentos();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function editarDocumento(docId){
            try{
                const doc=await db.collection('documentosAuditoria').doc(docId).get();
                if(!doc.exists){alert('Documento n√£o encontrado');return;}
                const d=doc.data();
                const categoriasDocs=['E-MAIL ENVIADO','E-MAIL RECEBIDO','COMPROVANTE','DOCUMENTO','PLANILHA','RELAT√ìRIO','OUTROS'];
                const pontosOpts=pontosAuditoria.map(p=>'<option value="'+p.id+'"'+(d.pontosRelacionados&&d.pontosRelacionados.includes(p.id)?' selected':'')+'>'+p.id+' - '+p.ponto.substring(0,50)+'</option>').join('');
                document.getElementById('modalDocumentoBody').innerHTML=`
                    <h4 style="color:var(--azul-marinho);margin-bottom:15px;"><i class="fas fa-edit"></i> Editar Documento</h4>
                    <div class="form-group"><label>T√≠tulo *</label><input type="text" id="editDocTitulo" value="${d.titulo||''}"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                        <div class="form-group"><label>Categoria</label><select id="editDocCategoria">${categoriasDocs.map(c=>'<option value="'+c+'"'+(d.categoria===c?' selected':'')+'>'+c+'</option>').join('')}</select></div>
                        <div class="form-group"><label>Data</label><input type="date" id="editDocData" value="${d.data||''}"></div>
                    </div>
                    <div class="form-group"><label>Descri√ß√£o</label><textarea id="editDocDescricao" rows="2">${d.descricao||''}</textarea></div>
                    <div class="form-group"><label>Pontos Relacionados</label><select id="editDocPontos" multiple style="height:100px;">${pontosOpts}</select></div>
                    <div class="form-group"><label>URL do Arquivo</label><input type="text" id="editDocURL" value="${d.urlArquivo||''}"></div>
                    <div class="form-group"><label>Conte√∫do</label><textarea id="editDocConteudo" rows="5">${d.conteudo||''}</textarea></div>
                    <div class="admin-buttons" style="margin-top:20px;">
                        <button class="btn-admin primary" onclick="salvarEdicaoDocumento('${docId}')"><i class="fas fa-save"></i> Salvar</button>
                        <button class="btn-admin danger" onclick="fecharModalDocumento()"><i class="fas fa-times"></i> Cancelar</button>
                    </div>
                `;
                document.getElementById('modalDocumento').classList.add('active');
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function salvarEdicaoDocumento(docId){
            const titulo=document.getElementById('editDocTitulo').value.trim();
            if(!titulo){alert('T√≠tulo √© obrigat√≥rio!');return;}
            const pontosSelect=document.getElementById('editDocPontos');
            const pontosSelecionados=Array.from(pontosSelect.selectedOptions).map(o=>o.value);
            try{
                await db.collection('documentosAuditoria').doc(docId).update({
                    titulo:titulo,
                    categoria:document.getElementById('editDocCategoria').value,
                    data:document.getElementById('editDocData').value,
                    descricao:document.getElementById('editDocDescricao').value.trim(),
                    pontosRelacionados:pontosSelecionados,
                    urlArquivo:document.getElementById('editDocURL').value.trim(),
                    conteudo:document.getElementById('editDocConteudo').value.trim(),
                    atualizadoEm:firebase.firestore.FieldValue.serverTimestamp()
                });
                alert('Documento atualizado!');
                fecharModalDocumento();
                listarDocumentos();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function downloadDocumentoWord(docId){
            try{
                const doc=await db.collection('documentosAuditoria').doc(docId).get();
                if(!doc.exists){alert('Documento n√£o encontrado');return;}
                const d=doc.data();
                const pontos=d.pontosRelacionados&&d.pontosRelacionados.length?d.pontosRelacionados.join(', '):'Nenhum';
                const conteudo=`
DOCUMENTO: ${d.titulo}
${'='.repeat(50)}

Categoria: ${d.categoria||'N/A'}
Data: ${d.data||'N/A'}
Pontos Relacionados: ${pontos}

DESCRI√á√ÉO:
${d.descricao||'Sem descri√ß√£o'}

${'‚îÄ'.repeat(50)}

CONTE√öDO:
${d.conteudo||'Sem conte√∫do'}

${'‚îÄ'.repeat(50)}
${d.urlArquivo?'URL do Arquivo: '+d.urlArquivo:''}

Gerado em: ${new Date().toLocaleString('pt-BR')}
Sistema de Auditoria Brasil 21
                `.trim();
                const blob=new Blob([conteudo],{type:'application/msword'});
                const url=URL.createObjectURL(blob);
                const a=document.createElement('a');
                a.href=url;
                a.download=d.titulo.replace(/[^a-zA-Z0-9]/g,'_')+'.doc';
                a.click();
                URL.revokeObjectURL(url);
            }catch(e){alert('Erro: '+e.message);}
        }
        
        // TIMELINE E EVENTOS
        let eventosTimeline=[];
        
        async function carregarEventos(){
            try{
                const snap=await db.collection('eventosTimeline').orderBy('data','asc').get();
                eventosTimeline=snap.docs.map(d=>({docId:d.id,...d.data()}));
                popularFiltroTimelinePA();
                renderizarGantt();
            }catch(e){console.log('Erro ao carregar eventos:',e);}
        }
        
        function renderizarGantt(){
            const container=document.getElementById('ganttContainer');
            if(!container)return;
            const filtroTipo=document.getElementById('filtroGanttTipo')?.value||'';
            
            // Coletar todos os eventos (sem duplicar)
            let eventos=[...eventosTimeline];
            if(filtroTipo)eventos=eventos.filter(e=>e.tipo===filtroTipo);
            
            // Adicionar documentos como eventos
            Object.values(documentosAdicionais).forEach(d=>{
                if(d.data){
                    eventos.push({titulo:d.titulo,data:d.data,dataFim:null,tipo:'email',isDoc:true});
                }
            });
            
            if(eventos.length===0){
                container.innerHTML='<p style="color:#666;padding:20px;text-align:center;">Nenhum evento encontrado. Clique em "Carregar Eventos Iniciais" na aba Admin.</p>';
                return;
            }
            
            // Remover duplicatas por t√≠tulo+data
            const eventosUnicos=[];
            const vistos=new Set();
            eventos.forEach(e=>{
                const chave=e.titulo+'|'+e.data;
                if(!vistos.has(chave)){
                    vistos.add(chave);
                    eventosUnicos.push(e);
                }
            });
            eventos=eventosUnicos;
            
            // Coletar todas as datas √∫nicas com eventos
            const datasComEventos=new Set();
            eventos.forEach(e=>{
                const dataInicio=new Date(e.data+'T12:00:00');
                const dataFim=e.dataFim?new Date(e.dataFim+'T12:00:00'):dataInicio;
                let current=new Date(dataInicio);
                while(current<=dataFim){
                    datasComEventos.add(current.toISOString().split('T')[0]);
                    current.setDate(current.getDate()+1);
                }
            });
            
            // Ordenar datas
            const datasOrdenadas=[...datasComEventos].sort();
            if(datasOrdenadas.length===0){
                container.innerHTML='<p style="color:#666;padding:20px;text-align:center;">Nenhum evento com data v√°lida.</p>';
                return;
            }
            
            // Agrupar por m√™s
            const mesesMap={};
            datasOrdenadas.forEach(dataStr=>{
                const d=new Date(dataStr+'T12:00:00');
                const mesKey=d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0');
                const mesNome=d.toLocaleString('pt-BR',{month:'short'}).toUpperCase()+'/'+d.getFullYear();
                if(!mesesMap[mesKey])mesesMap[mesKey]={nome:mesNome,dias:[],mes:d.getMonth()};
                mesesMap[mesKey].dias.push({date:d,dia:d.getDate(),dateStr:dataStr});
            });
            
            const meses=Object.values(mesesMap).sort((a,b)=>a.dias[0].date-b.dias[0].date);
            const todasColunas=[];
            meses.forEach(m=>m.dias.forEach(d=>todasColunas.push(d)));
            
            // Cores dos meses
            const coresMes=['#1565c0','#2e7d32','#c62828','#7b1fa2','#ef6c00'];
            
            // Construir HTML do Gantt compacto
            let html='<div class="gantt-wrapper">';
            
            // Header com meses
            html+='<div class="gantt-header">';
            html+='<div class="gantt-header-task">Evento / Atividade</div>';
            html+='<div class="gantt-header-months">';
            meses.forEach((m,i)=>{
                const largura=m.dias.length*45;
                html+=`<div class="gantt-month" style="width:${largura}px;background:${coresMes[i%coresMes.length]};">${m.nome}</div>`;
            });
            html+='</div></div>';
            
            // Header com dias
            html+='<div class="gantt-days">';
            html+='<div class="gantt-days-label">Dias ‚Üí</div>';
            todasColunas.forEach(d=>{
                html+=`<div class="gantt-day" style="min-width:45px;max-width:45px;">${String(d.dia).padStart(2,'0')}</div>`;
            });
            html+='</div>';
            
            // Linhas de eventos
            eventos.sort((a,b)=>new Date(a.data)-new Date(b.data));
            eventos.forEach((ev,idx)=>{
                const evDataInicio=new Date(ev.data+'T12:00:00');
                const evDataFim=ev.dataFim?new Date(ev.dataFim+'T12:00:00'):evDataInicio;
                const dataInicioStr=evDataInicio.toLocaleDateString('pt-BR');
                const dataFimStr=ev.dataFim?evDataFim.toLocaleDateString('pt-BR'):'';
                
                html+='<div class="gantt-row">';
                html+=`<div class="gantt-task">
                    <div class="gantt-task-title" title="${ev.titulo}">${ev.titulo}</div>
                    <div class="gantt-task-dates">${dataInicioStr}${dataFimStr?' - '+dataFimStr:''}</div>
                </div>`;
                html+='<div class="gantt-cells">';
                
                // Encontrar √≠ndices de in√≠cio e fim
                const startIdx=todasColunas.findIndex(c=>c.dateStr===ev.data);
                const endIdx=ev.dataFim?todasColunas.findIndex(c=>c.dateStr===ev.dataFim):startIdx;
                
                // C√©lulas
                todasColunas.forEach((col,colIdx)=>{
                    const isInRange=colIdx>=startIdx&&colIdx<=(endIdx>=0?endIdx:startIdx);
                    html+=`<div class="gantt-cell" style="min-width:45px;max-width:45px;${isInRange?'':''}"></div>`;
                });
                
                // Barra do evento
                if(startIdx>=0){
                    const left=startIdx*45;
                    const width=((endIdx>=0?endIdx:startIdx)-startIdx+1)*45-4;
                    html+=`<div class="gantt-bar ${ev.tipo}" style="left:${left+2}px;width:${Math.max(width,40)}px;" 
                        onclick="mostrarTooltipGantt(event,'${ev.titulo.replace(/'/g,"\\'")}','${dataInicioStr}','${dataFimStr}','${ev.tipo}','${(ev.observacoes||'').replace(/'/g,"\\'")}')"
                        onmouseout="ocultarTooltipGantt()"></div>`;
                }
                
                html+='</div></div>';
            });
            
            html+='</div>';
            container.innerHTML=html;
        }
        
        function mostrarTooltipGantt(event,titulo,dataInicio,dataFim,tipo,obs){
            let tooltip=document.getElementById('ganttTooltip');
            if(!tooltip){
                tooltip=document.createElement('div');
                tooltip.id='ganttTooltip';
                tooltip.className='gantt-tooltip';
                document.body.appendChild(tooltip);
            }
            tooltip.innerHTML=`
                <strong>${titulo}</strong><br>
                <span style="font-size:0.75rem;opacity:0.9;">
                ${tipo.charAt(0).toUpperCase()+tipo.slice(1)}<br>
                ${dataInicio}${dataFim?' at√© '+dataFim:''}
                ${obs?'<br><br>'+obs:''}
                </span>
            `;
            tooltip.style.display='block';
            tooltip.style.left=(event.pageX-20)+'px';
            tooltip.style.top=(event.pageY-tooltip.offsetHeight-15)+'px';
        }
        
        function ocultarTooltipGantt(){
            const tooltip=document.getElementById('ganttTooltip');
            if(tooltip)tooltip.style.display='none';
        }
        
        function getCorTipo(tipo){
            const cores={visita:'#2e7d32',entrega:'#1565c0',email:'#ef6c00',reuniao:'#7b1fa2',prazo:'#c62828',outro:'#546e7a'};
            return cores[tipo]||'#0D1B2A';
        }
        
        function toggleSecaoAdmin(secaoId){
            const secao=document.getElementById(secaoId);
            if(secao){
                secao.style.display=secao.style.display==='none'?'block':'none';
            }
        }
        
        function toggleSecoesAvancadas(){
            const mostrar=document.getElementById('chkMostrarAvancado').checked;
            document.querySelectorAll('.secao-avancada').forEach(el=>{
                el.style.display=mostrar?'block':'none';
            });
        }
        
        function formatarDataEvento(data,dataFim){
            if(!data)return'N/A';
            const d=new Date(data+'T12:00:00');
            const dia=d.getDate().toString().padStart(2,'0');
            const mes=(d.getMonth()+1).toString().padStart(2,'0');
            const ano=d.getFullYear();
            if(dataFim){
                const df=new Date(dataFim+'T12:00:00');
                return dia+'/'+mes+'/'+ano+' - '+df.getDate().toString().padStart(2,'0')+'/'+(df.getMonth()+1).toString().padStart(2,'0')+'/'+df.getFullYear();
            }
            return dia+'/'+mes+'/'+ano;
        }
        
        function abrirModalNovoEvento(eventoId=null){
            const tipos=['visita','entrega','email','reuniao','prazo','outro'];
            const pasOpts=pontosAuditoria.map(p=>'<option value="'+p.id+'">'+p.id+'</option>').join('');
            document.getElementById('modalDocumentoBody').innerHTML=`
                <h4 style="color:var(--azul-marinho);margin-bottom:15px;"><i class="fas fa-calendar-plus"></i> ${eventoId?'Editar':'Novo'} Evento</h4>
                <div class="form-group"><label>T√≠tulo do Evento *</label><input type="text" id="eventoTitulo" placeholder="Ex: Visita da Auditoria"></div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                    <div class="form-group"><label>Data In√≠cio *</label><input type="date" id="eventoData"></div>
                    <div class="form-group"><label>Data Fim (opcional)</label><input type="date" id="eventoDataFim"></div>
                </div>
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                    <div class="form-group"><label>Hora (opcional)</label><input type="time" id="eventoHora"></div>
                    <div class="form-group"><label>Tipo *</label><select id="eventoTipo">${tipos.map(t=>'<option value="'+t+'">'+t.charAt(0).toUpperCase()+t.slice(1)+'</option>').join('')}</select></div>
                </div>
                <div class="form-group"><label>PAs Relacionados</label><select id="eventoPAs" multiple style="height:80px;">${pasOpts}</select></div>
                <div class="form-group"><label>Observa√ß√µes</label><textarea id="eventoObs" rows="2"></textarea></div>
                <div class="admin-buttons" style="margin-top:20px;">
                    <button class="btn-admin primary" onclick="salvarEvento('${eventoId||''}')"><i class="fas fa-save"></i> Salvar</button>
                    <button class="btn-admin danger" onclick="fecharModalDocumento()"><i class="fas fa-times"></i> Cancelar</button>
                </div>
            `;
            document.getElementById('modalDocumento').classList.add('active');
        }
        
        async function salvarEvento(eventoId){
            const titulo=document.getElementById('eventoTitulo').value.trim();
            const data=document.getElementById('eventoData').value;
            const tipo=document.getElementById('eventoTipo').value;
            if(!titulo||!data||!tipo){alert('Preencha os campos obrigat√≥rios!');return;}
            const pasSelect=document.getElementById('eventoPAs');
            const evento={
                titulo,data,tipo,
                dataFim:document.getElementById('eventoDataFim').value||null,
                hora:document.getElementById('eventoHora').value||null,
                pasRelacionados:Array.from(pasSelect.selectedOptions).map(o=>o.value),
                observacoes:document.getElementById('eventoObs').value.trim(),
                criadoEm:firebase.firestore.FieldValue.serverTimestamp()
            };
            try{
                if(eventoId)await db.collection('eventosTimeline').doc(eventoId).update(evento);
                else await db.collection('eventosTimeline').add(evento);
                alert('Evento salvo!');
                fecharModalDocumento();
                carregarEventos();
                listarEventos();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function listarEventos(){
            const container=document.getElementById('listaEventosAdmin');
            if(!container)return;
            container.innerHTML='<p style="color:#666;">Carregando...</p>';
            try{
                const snap=await db.collection('eventosTimeline').orderBy('data','asc').get();
                if(snap.empty){container.innerHTML='<p style="color:#666;">Nenhum evento cadastrado.</p>';return;}
                let html='<div style="max-height:300px;overflow-y:auto;">';
                snap.docs.forEach(doc=>{
                    const e=doc.data();
                    html+=`<div style="background:#f8f9fa;padding:10px;border-radius:8px;margin-bottom:8px;border-left:4px solid ${getCorTipo(e.tipo)};display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <strong>${e.titulo}</strong>
                            <span class="timeline-tipo ${e.tipo}">${e.tipo}</span>
                            <div style="font-size:0.8rem;color:#666;">${formatarDataEvento(e.data,e.dataFim)}${e.hora?' √†s '+e.hora:''}</div>
                        </div>
                        <div style="display:flex;gap:5px;">
                            <button onclick="editarEvento('${doc.id}')" style="background:var(--azul-claro);color:white;border:none;padding:5px 8px;border-radius:5px;cursor:pointer;"><i class="fas fa-edit"></i></button>
                            <button onclick="excluirEvento('${doc.id}')" style="background:var(--vermelho);color:white;border:none;padding:5px 8px;border-radius:5px;cursor:pointer;"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                });
                html+='</div>';
                container.innerHTML=html;
            }catch(e){container.innerHTML='<p style="color:var(--vermelho);">Erro: '+e.message+'</p>';}
        }
        
        async function editarEvento(eventoId){
            try{
                const doc=await db.collection('eventosTimeline').doc(eventoId).get();
                if(!doc.exists)return;
                const e=doc.data();
                abrirModalNovoEvento(eventoId);
                setTimeout(()=>{
                    document.getElementById('eventoTitulo').value=e.titulo||'';
                    document.getElementById('eventoData').value=e.data||'';
                    document.getElementById('eventoDataFim').value=e.dataFim||'';
                    document.getElementById('eventoHora').value=e.hora||'';
                    document.getElementById('eventoTipo').value=e.tipo||'outro';
                    if(e.pasRelacionados){
                        const sel=document.getElementById('eventoPAs');
                        e.pasRelacionados.forEach(pa=>{
                            const opt=sel.querySelector('option[value="'+pa+'"]');
                            if(opt)opt.selected=true;
                        });
                    }
                    document.getElementById('eventoObs').value=e.observacoes||'';
                },100);
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function excluirEvento(eventoId){
            if(!confirm('Excluir este evento?'))return;
            try{
                await db.collection('eventosTimeline').doc(eventoId).delete();
                alert('Evento exclu√≠do!');
                carregarEventos();
                listarEventos();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function carregarEventosIniciais(){
            if(!confirm('Isso vai criar os eventos iniciais da timeline (se ainda n√£o existirem). Continuar?'))return;
            const eventosIniciais=[
                {titulo:'Visita da Auditoria',data:'2025-10-06',dataFim:'2025-10-10',tipo:'visita',pasRelacionados:[],observacoes:'Visita in loco da equipe de auditoria'},
                {titulo:'Entrega dos Relat√≥rios',data:'2025-10-24',tipo:'entrega',pasRelacionados:[],observacoes:'Apresenta√ß√£o dos relat√≥rios e cria√ß√£o dos 118 PAs'},
                {titulo:'E-mail Fabiano - Gest√£o Estrat√©gica',data:'2025-10-29',hora:'13:02',tipo:'email',pasRelacionados:[],observacoes:'Questionamentos sobre preju√≠zos e provid√™ncias'},
                {titulo:'Prazo de Resposta dos PAs',data:'2025-11-03',tipo:'prazo',pasRelacionados:[],observacoes:'Prazo de 10 dias para resposta dos 118 PAs'}
            ];
            try{
                // Verificar eventos existentes
                const existentes=await db.collection('eventosTimeline').get();
                const titulosExistentes=new Set(existentes.docs.map(d=>d.data().titulo));
                let criados=0;
                for(const ev of eventosIniciais){
                    if(!titulosExistentes.has(ev.titulo)){
                        ev.criadoEm=firebase.firestore.FieldValue.serverTimestamp();
                        await db.collection('eventosTimeline').add(ev);
                        criados++;
                    }
                }
                if(criados>0)alert(criados+' evento(s) criado(s)!');
                else alert('Todos os eventos j√° existem!');
                carregarEventos();
                listarEventos();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        async function atualizarDatasTodosPAs(){
            if(!confirm('Isso vai definir para todos os 118 PAs:\n- Data In√≠cio: 24/10/2025\n- Data Previs√£o: 03/11/2025\n\nContinuar?'))return;
            try{
                const snap=await db.collection('pontosAuditoria').get();
                let count=0;
                for(const doc of snap.docs){
                    await doc.ref.update({dataInicio:'2025-10-24',dataPrevisao:'2025-11-03'});
                    count++;
                }
                // Atualizar localmente
                pontosAuditoria.forEach(p=>{p.dataInicio='2025-10-24';p.dataPrevisao='2025-11-03';});
                alert('Datas atualizadas em '+count+' PAs!');
                renderizarGantt();
            }catch(e){alert('Erro: '+e.message);}
        }
        
        // BACKUP E RESTAURA√á√ÉO
        async function gerarBackupCompleto(){
            const status=document.getElementById('statusBackup');
            status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Gerando backup...';
            status.style.color='var(--azul-claro)';
            try{
                const backup={
                    versao:'1.0',
                    dataBackup:new Date().toISOString(),
                    sistema:'Auditoria Brasil 21',
                    dados:{}
                };
                // Pontos de Auditoria
                const pontosSnap=await db.collection('pontosAuditoria').get();
                backup.dados.pontosAuditoria=pontosSnap.docs.map(d=>({id:d.id,...d.data()}));
                status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Exportando coordenadas...';
                // Coordenadas PDF
                const coordsSnap=await db.collection('coordenadasPDF').get();
                backup.dados.coordenadasPDF=coordsSnap.docs.map(d=>({id:d.id,...d.data()}));
                status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Exportando documentos...';
                // Documentos
                const docsSnap=await db.collection('documentosAuditoria').get();
                backup.dados.documentosAuditoria=docsSnap.docs.map(d=>({id:d.id,...d.data()}));
                status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Exportando usu√°rios...';
                // Usu√°rios
                const usersSnap=await db.collection('usuarios').get();
                backup.dados.usuarios=usersSnap.docs.map(d=>({id:d.id,...d.data()}));
                // Resumo
                backup.resumo={
                    pontosAuditoria:backup.dados.pontosAuditoria.length,
                    coordenadasPDF:backup.dados.coordenadasPDF.length,
                    documentosAuditoria:backup.dados.documentosAuditoria.length,
                    usuarios:backup.dados.usuarios.length
                };
                // Gerar arquivo
                const blob=new Blob([JSON.stringify(backup,null,2)],{type:'application/json'});
                const url=URL.createObjectURL(blob);
                const a=document.createElement('a');
                const dataHora=new Date().toISOString().replace(/[:.]/g,'-').slice(0,19);
                a.href=url;
                a.download='backup_auditoria_brasil21_'+dataHora+'.json';
                a.click();
                URL.revokeObjectURL(url);
                status.innerHTML='<i class="fas fa-check-circle"></i> Backup gerado com sucesso! ('+backup.resumo.pontosAuditoria+' pontos, '+backup.resumo.coordenadasPDF+' coordenadas, '+backup.resumo.documentosAuditoria+' documentos, '+backup.resumo.usuarios+' usu√°rios)';
                status.style.color='var(--verde)';
            }catch(e){
                status.innerHTML='<i class="fas fa-times-circle"></i> Erro: '+e.message;
                status.style.color='var(--vermelho)';
            }
        }
        
        async function restaurarBackup(event){
            const file=event.target.files[0];
            if(!file)return;
            const status=document.getElementById('statusBackup');
            if(!confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso ir√° SUBSTITUIR todos os dados atuais pelos dados do backup!\\n\\nDeseja continuar?'))return;
            if(!confirm('Tem CERTEZA ABSOLUTA? Esta a√ß√£o n√£o pode ser desfeita!'))return;
            status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Lendo arquivo...';
            status.style.color='var(--azul-claro)';
            try{
                const texto=await file.text();
                const backup=JSON.parse(texto);
                if(!backup.versao||!backup.dados){
                    throw new Error('Arquivo de backup inv√°lido');
                }
                // Restaurar Pontos de Auditoria
                if(backup.dados.pontosAuditoria&&backup.dados.pontosAuditoria.length>0){
                    status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Restaurando pontos de auditoria...';
                    const pontosSnap=await db.collection('pontosAuditoria').get();
                    for(const doc of pontosSnap.docs)await doc.ref.delete();
                    for(const ponto of backup.dados.pontosAuditoria){
                        const {id,...dados}=ponto;
                        await db.collection('pontosAuditoria').add(dados);
                    }
                }
                // Restaurar Coordenadas PDF
                if(backup.dados.coordenadasPDF&&backup.dados.coordenadasPDF.length>0){
                    status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Restaurando coordenadas...';
                    const coordsSnap=await db.collection('coordenadasPDF').get();
                    for(const doc of coordsSnap.docs)await doc.ref.delete();
                    for(const coord of backup.dados.coordenadasPDF){
                        await db.collection('coordenadasPDF').doc(coord.id).set(coord);
                    }
                }
                // Restaurar Documentos
                if(backup.dados.documentosAuditoria&&backup.dados.documentosAuditoria.length>0){
                    status.innerHTML='<i class="fas fa-spinner fa-spin"></i> Restaurando documentos...';
                    const docsSnap=await db.collection('documentosAuditoria').get();
                    for(const doc of docsSnap.docs)await doc.ref.delete();
                    for(const documento of backup.dados.documentosAuditoria){
                        const {id,...dados}=documento;
                        await db.collection('documentosAuditoria').add(dados);
                    }
                }
                status.innerHTML='<i class="fas fa-check-circle"></i> Backup restaurado com sucesso! Recarregando...';
                status.style.color='var(--verde)';
                setTimeout(()=>location.reload(),2000);
            }catch(e){
                status.innerHTML='<i class="fas fa-times-circle"></i> Erro: '+e.message;
                status.style.color='var(--vermelho)';
            }
            event.target.value='';
        }
    </script>
    
    <!-- Modal Novo Documento -->
    <div class="modal" id="modalDocumento" style="z-index:2000;">
        <div class="modal-content" style="max-width:600px;">
            <div class="modal-header">
                <h3><i class="fas fa-file-alt"></i> <span>Documento</span></h3>
                <button class="btn-close" onclick="fecharModalDocumento()">&times;</button>
            </div>
            <div class="modal-body" id="modalDocumentoBody"></div>
        </div>
    </div>
</body>
</html>
